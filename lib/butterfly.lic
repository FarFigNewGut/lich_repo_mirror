=begin
;butterfly - Change the name of all characters, npcs, mobs and loot to various types of butterfly

;butterfly pro - I'M A PRETTY GIRL
=end

# Global variables
$pro_mode = script.vars[1] == "pro"
$name_cache = {}
$butterfly_names = [
  "Monarch", "Swallowtail", "Morpho", "Painted Lady", "Peacock",
  "Red Admiral", "Blue Morpho", "Luna Moth", "Tiger Swallowtail", "Cabbage White",
  "Fritillary", "Skipper", "Brimstone", "Orange Sulphur", "Clouded Yellow",
  "Apollo", "Adonis Blue", "Aglais io", "American Copper", "Anise Swallowtail",
  "Anna's Eighty-eight", "Appias nero", "Archduke", "Atala", "Atlas Moth",
  "Australian Painted Lady", "Autumn Leaf", "Axel's Satyr", "Azure", "Baltimore Checkerspot",
  "Banana Moth", "Banded Orange Heliconian", "Banded Peacock", "Bath White", "Bay Checkerspot",
  "Beaded Wood-nymph", "Birdwing", "Black Hairstreak", "Black Jezebel", "Black Prince",
  "Black Swallowtail", "Blue Dasher", "Blue Emperor", "Blue Metalmark", "Blue Pansy",
  "Blue Triangle", "Blue-banded Eggfly", "Brush-footed", "Buckeye", "Burmese Lascar",
  "Calypso White", "Camberwell Beauty", "Cassius Blue", "Chalkhill Blue", "Chequered Blue",
  "Cherry Gall Azure", "Chestnut", "Chocolate Albatross", "Citrus Swallowtail", "Clipper",
  "Clodius Parnassian", "Common Baron", "Common Blue", "Common Buckeye", "Common Eggfly",
  "Common Jester", "Common Mime", "Common Mormon", "Common Sailor", "Common Sergea",
  "Common Sootywing", "Common Wood-Nymph", "Copper", "Coral Hairstreak", "Cramer's Eighty-eight",
  "Creamy Punch", "Crimson Patch", "Crimson-patched Longwing", "Cruiser", "Cycad Blue",
  "Danaid Eggfly", "Dark Blue Tiger", "Dartwhite", "Diana Fritillary", "Dingy Skipper",
  "Dot-underwing", "Duke of Burgundy", "Eastern Black Swallowtail", "Eastern Comma", "Eastern Pine Elfin",
  "Eastern Tailed-Blue", "Eastern Tiger Swallowtail", "Elbowed Pierrot", "Emerald Swallowtail", "Emperor",
  "Falcate Orangetip", "Fiery Skipper", "Forest Mother-of-Pearl", "Freyer's Purple Emperor", "Frilled Coquette",
  "Gatekeeper", "Giant Blue Swallowtail", "Giant Owl", "Giant Swallowtail", "Glasswinged Butterfly",
  "Glanville Fritillary", "Glasswing", "Glider", "Golden Birdwing", "Golden Hairstreak",
  "Goliath Birdwing", "Gossamer-winged", "Gram Blue", "Gray Comma", "Gray Hairstreak",
  "Great Blue Hairstreak", "Great Eggfly", "Great Mormon", "Great Orange Tip", "Great Purple Emperor",
  "Great Spangled Fritillary", "Green Hairstreak", "Green-veined White", "Grizzled Skipper", "Gulf Fritillary",
  "Hackberry Emperor", "Heliconius", "Hercules Moth", "Hermit", "Holly Blue",
  "Humming-bird Hawk-moth", "Indigo Flash", "Io Moth", "Jade Swallowtail", "Julia Heliconian",
  "Juniper Hairstreak", "Karner Blue", "Katydid", "Keyhole Flyer", "King's Hairstreak",
  "Lace Wing", "Large Blue", "Large Copper", "Large Marble", "Large White",
  "Leopard Lacewing", "Lesser Purple Emperor", "Lilac-banded Swallowtail", "Little Wood Satyr", "Lorquin's Admiral",
  "Lycaenid", "Machaon", "Madagascar Sunset Moth", "Magpie Moth", "Malachite",
  "Mangrove Skipper", "Map", "Marbled White", "Marsh Fritillary", "Meadow Brown",
  "Meadow Fritillary", "Mexican Bluewing", "Milbert's Tortoiseshell", "Milkweed", "Mitra Forester",
  "Mottled Emigrant", "Mourning Cloak", "Nymphalid", "Oak Blue", "Old World Swallowtail",
  "Oleander Hawk-moth", "Orange Oakleaf", "Orange Sulphur", "Orange-barred Sulphur", "Oregon Swallowtail",
  "Pale Grass Blue", "Pale Swallowtail", "Pale Tiger", "Palmfly", "Papilio Constantinus",
  "Peacock Butterfly", "Pearl-bordered Fritillary", "Pearly Heath", "Peppered Moth", "Phaon Crescent",
  "Phoebus Apollo", "Pine White", "Plain Tiger", "Polydamas Swallowtail", "Popinjay",
  "Postman", "Purple Emperor", "Purple Hairstreak", "Purple-shot Copper", "Queen Alexandra's Birdwing",
  "Queen of Spain Fritillary", "Question Mark", "Red Cracker", "Red Glider", "Red Lacewing",
  "Red Pierrot", "Red Postman", "Red-banded Hairstreak", "Red-spotted Purple", "Regent Skipper",
  "Ringed Xenica", "Ringlet", "Rocky Mountain Parnassian", "Ruddy Daggerwing", "Sara Orangetip",
  "Satyr", "Scarce Copper", "Scarce Swallowtail", "Scarlet Mormon", "Scarlet Peacock",
  "Scotch Argus", "Silver-studded Blue", "Silver-washed Fritillary", "Silvery Blue", "Six-spot Burnet",
  "Small Blue", "Small Copper", "Small Heath", "Small Tortoiseshell", "Small White",
  "Sootywing", "Southern Dogface", "Speckled Wood", "Spicebush Swallowtail", "Spring Azure",
  "Square-spotted Blue", "Striped Blue Crow", "Sulphur", "Swallowtail", "Sword-grass Brown",
  "Tailed Emperor", "Tailed Jay", "Tawny Coster", "Tawny Emperor", "The Copper",
  "Thoas Swallowtail", "Tooth", "Transparent Diadem", "Tree Nymph", "Tropical Buckeye",
  "Two-tailed Pasha", "Ulysses", "Variable Checkerspot", "Variable Cracker", "Viceroy",
  "Wall Brown", "Wanderer", "Western Pine Elfin", "Western Tiger Swallowtail", "White Admiral",
  "White Morpho", "White Peacock", "White-letter Hairstreak", "Wood Nymph", "Wood White",
  "Woodland Brown", "Yellow Admiral", "Yellow Jezebel", "Yellow Pansy", "Yellow Sulphur",
  "Zebra Longwing", "Zebra Swallowtail", "Zephyr"
]

# Helper methods
def safe_process_gameobj(collection)
  collection.respond_to?(:each) ? collection : []
end

def get_butterfly_name(original_name)
  $name_cache[original_name] ||= "#{$butterfly_names.sample} Butterfly"
end

def process_text_pro(text)
  text.gsub(/\b\w+\b/, 'butterfly')
end

def process_text_normal(text)
  gameobjs = safe_process_gameobj(GameObj.pcs) + 
             safe_process_gameobj(GameObj.npcs) +
             safe_process_gameobj(GameObj.loot)
  
  gameobjs.each do |obj|
    next unless obj.name
    text.gsub!(obj.name, get_butterfly_name(obj.name))
  end
  text
end

# Main processing hook
rename_objects = proc do |text|
  $pro_mode ? process_text_pro(text) : process_text_normal(text)
end

# Script setup and teardown
DownstreamHook.add("rename_objects", rename_objects)
before_dying { DownstreamHook.remove("rename_objects") }

# Main loop
loop { sleep 1 }