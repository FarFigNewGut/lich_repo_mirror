=begin
   https://discordapp.com/channels/226045346399256576/1339018254517145681

   This script creates a dedicated window to display all signature verbs, race specific verbs, fanspeak verbs, and roleplay verbs available to the player.
   Race specific verbs are automatically loaded for the players race according to Lich.
   Roleplay verbs are any verb that performs an action seen by others by using VERB or VERB YOURNAMEHERE.
   
   Features:
   - Some verbs can be executed with the verb only by clicking ( ! ).
   - Some verbs can be executed with the verb YOURNAMEHERE by clicking (S).
   - Tags signature verbs that require a player target with (T).
   - Allows the player to customize the list by clicking an [ X ] to hide signature or regular verbs.
   - Hidden verbs are populated at the very bottom of the window and can be clicked to make them unhidden.
   - Players can load a built in profile using ;send load PROFILENAME or use one of the built in profiles.
   - You can also save a custom profile using ;send save PROFILENAME which stores the current visible regular verbs.
   - A reverse lookup window is available by typing ;send reverse in game.
   - ;send help for the help menu.
   - All regular, race, and hidden verbs can have their visibility enabled or disabled in the window by typing ;send regular, ;send race, or ;send hidden.
   
   Tips:
   - First time! Run this someplace quiet for the first time.
     ;verbwindow
     ;send build	 
   - Add these lines to Wrayth Text Highlights and color them black.
     exec1:
     Lich: exec1 has exited.
     Lich: exec1 active.
   
   Coming Soon:
   - Culture verbs will be added.
   - Roleplay items such as The Blood Red Hand https://gswiki.play.net/Blood_Red_Hand will be added.
   
   Changelog:
     1.8.0 (2025-04-16)
            All of the citizenship verbs have been added. The premium verbs for express have been added. These can be turned off via ;send premium.
     1.7.0 (2025-04-14)
            Added fanspeak verbs.
     1.6.0 (2025-04-13)
            Added race specific verbs for erithian, burghal gnome, forest gnome, halfling, and half-krolvin.
            Added citizenship verbs for solhaven.
            Added ;send citizenship command to enable or disable citizenship verbs.
     1.5.1 (2025-04-12)
            Noticed it really bogged down lich when running for first time or ;send build. I think that's fixed and it works a lot better on my end.
     1.5.0 (2025-04-12)
            Added race specific verbs for dark elf, half elf, and sylvankind.
     1.4.1 (2025-04-11)
            Fixed error in yaml structure.
     1.4.0 (2025-04-11)
            Added elf race specific verbs.
     1.3.0 (2025-04-11)
            Added human race specific verbs.
     1.2.0 (2025-04-11)
            Added aelotoi race specific verbs.
     1.1.0 (2025-04-11)
            Added new commands and giantman race specific verbs.
     1.1.0 (2025-04-11)
            Rebuilt verb database to include 190 roleplay verbs.
     1.0.0 (2025-04-10)
            Initial release.
	   
author: Phocosoen, ChatGPT
contributors: Tysong, Nisgui
tags: wrayth, frontend, mod, window, signature, emote, verb
version: 1.4.1
=end

require 'yaml'

VERB_YAML_DATA = [
"---",
"a:",
"- verb: agree",
"  notarget: You adopt an agreeable expression.",
"  self: Your self-confidence rises.",
"- verb: answer",
"  notarget: You glance around as if trying to find the answer.",
"  self: You stand proudly as if you have the answer.",
"- verb: applaud",
"  notarget: You applaud.",
"  self: You clap your hands.",
"- verb: approve",
"  notarget: You give an approval gesture with your hand.",
"- verb: arrest",
"  notarget: Everyone better respect your authorit-ay!",
"b:",
"- verb: babble",
"  notarget: Babbling again, eh?",
"- verb: bark",
"  notarget: You bark loudly!",
"  self: You bark happily to yourself!",
"- verb: beam",
"  notarget: You beam!",
"  self: You beam happily!",
"- verb: beg",
"  notarget: You beg.",
"  self: You beg and plead to yourself.  Give in!  No!  Please!!!",
"- verb: belch",
"  notarget: You belch.",
"- verb: beseech",
"  notarget: You beseech your deity for some divine assistance.",
"- verb: blanch",
"  notarget: You feel the blood drain from your face.",
"- verb: bleat",
"  notarget: You bleat.",
"- verb: blink",
"  notarget: You blink.",
"  self: You close your eyes for a moment.",
"- verb: blush",
"  notarget: Your cheeks flush with a deep shade of red.",
"  self: You blush sheepishly to yourself.",
"- verb: bounce",
"  notarget: You bounce around happily.",
"  self: You fling yourself at the ground, hoping that you'll bounce....Predictably, you don't.",
"- verb: breathe",
"  notarget: You take a deep breath.",
"- verb: bristle",
"  notarget: Try as you might, you lack the small muscle coordination necessary to bristle.",
"- verb: brush",
"  notarget: You brush yourself off.",
"c:",
"- verb: cackle",
"  notarget: You cackle!",
"- verb: chant",
"  notarget: You chant an esoteric incantation as small sparks surround your hands.",
"- verb: cheer",
"  notarget: You let out a cheer!",
"  self: You burst out in a resounding cheer!",
"- verb: chortle",
"  notarget: You chortle.",
"- verb: chuckle",
"  notarget: You chuckle.",
"  self: You chuckle to yourself.",
"- verb: clutch",
"  notarget: You wring your hands.",
"  self: You clutch your chest in mock horror.",
"- verb: conside",
"  notarget: You rub your chin thoughtfully.",
"- verb: cough",
"  notarget: You cough.",
"- verb: crack",
"  notarget: You crack your knuckles!",
"- verb: cringe",
"  notarget: You cringe.",
"  self: You make a face like you just ate a bug.",
"- verb: cry",
"  notarget: You start to cry all over the place.",
"- verb: curse",
"  notarget: You curse the day you were born.",
"  self: You let loose with an involved curse detailing your own improbable ancestry.",
"- verb: curtsy",
"  notarget: You curtsy.",
"d:",
"- verb: dance",
"  notarget: You dance around the area to music only you can hear.",
"  self: Lifting your hands above your head, you clap in a steady rhythm and dance about.",
"- verb: daydream",
"  notarget: You lose yourself completely in a daydream...",
"- verb: dismiss",
"  notarget: You wave your hand in a dismissive gesture.",
"  self: You chatter to yourself, debating with your alter ego.",
"- verb: drool",
"  notarget: You drool.",
"- verb: duck",
"  notarget: You duck your head.",
"  self: Raising your arms defensively, you duck behind your forearms.",
"e:",
"- verb: eat",
"  self: You chew on your fingernails.  Mm, delicious.",
"- verb: encumbrance",
"  notarget: You adjust your gear comfortably and feel satisfied that you are not encumbered",
"    enough to notice.",
"- verb: exhale",
"  notarget: You slowly and deliberately empty your filled lungs.",
"  self: You release a slow, low whistle.",
"f:",
"- verb: fall",
"  notarget: You fall over.  Clumsy oaf!",
"- verb: feed",
"  self: At the thought of food, your stomach growls.",
"- verb: flail",
"  notarget: You flail your arms about.",
"- verb: flap",
"  notarget: You flap your arms wildly in an attempt at flight.",
"- verb: flick",
"  notarget: You make a flicking motion with your hand.",
"- verb: flirt",
"  notarget: You bat your eyelashes.",
"  self: You bat your eyelashes for attention.",
"- verb: flutter",
"  notarget: You flutter your eyelashes.",
"- verb: fly",
"  notarget: You turn your eyes to the sky and gaze upward enviously.",
"  self: You flap your arms experimentally, then release a long sigh of disappointment.",
"- verb: fold",
"  notarget: You fold your arms over your chest.",
"  self: You place your arms akimbo and look about as if waiting for something.",
"- verb: fret",
"  notarget: You fret.",
"- verb: frown",
"  notarget: You frown.",
"g:",
"- verb: gag",
"  notarget: You gag.",
"  self: You gag deep in your throat, making a choking sound.",
"- verb: gasp",
"  notarget: You gasp.",
"- verb: gawk",
"  notarget: Your jaw drops.",
"  self: You cross your eyes.",
"- verb: giggle",
"  notarget: You giggle.",
"  self: You giggle to yourself.",
"- verb: glance",
"  self: You glance around the room.",
"- verb: glare",
"  notarget: You glare.",
"  self: You glare at everything in the room.",
"- verb: glower",
"  notarget: You glower.",
"  self: You hunch up your shoulders and sulk, glowering sullenly at nothing in particular.",
"- verb: gnash",
"  notarget: You gnash your teeth in frustration!",
"- verb: gobble",
"  notarget: You make a gobbling sound.",
"- verb: grieve",
"  notarget: You throw back your head and let out a loud keening cry of pure grief.",
"  self: You fall to the ground and let out a heart breaking cry of pure grief.",
"- verb: grimace",
"  notarget: You grimace.",
"- verb: grin",
"  notarget: You grin.",
"  self: You try hard not to grin.",
"- verb: groan",
"  notarget: You groan.",
"- verb: grovel",
"  notarget: You fall to your knees and begin to grovel desperately.",
"  self: You find within yourself two conflicting attitudes.",
"- verb: growl",
"  notarget: You growl ferociously!",
"  self: You growl to yourself.",
"- verb: grumble",
"  notarget: You grumble.",
"  self: You grumble to yourself.",
"- verb: grunt",
"  notarget: You grunt.",
"- verb: guard",
"  self: You mill about, but really don't have a clue what to do.",
"- verb: gulp",
"  notarget: You gulp.",
"h:",
"- verb: hiccup",
"  notarget: You hiccup.",
"- verb: hiss",
"  notarget: You hiss.",
"  self: You inhale sharply, hissing through your teeth.",
"- verb: hoot",
"  notarget: You hoot.",
"  self: You hoot excitedly!",
"- verb: howl",
"  notarget: You throw your head back and howl!",
"- verb: hum",
"  notarget: You hum a random, wandering tune.",
"  self: You hum distractedly as your mind wanders.",
"i:",
"- verb: ignore",
"  notarget: You pretend to be oblivious to the world around you.",
"  self: You try to figure out how to ignore yourself.",
"- verb: inspect",
"  self: You inspect yourself carefully, making sure you're all right.",
"j:",
"- verb: jeer",
"  notarget: You let loose with a loud jeer.  Boooooo!",
"  self: You stare off into space and begin listing your own short-comings.  Boooooo, you stink!",
"- verb: jump",
"  notarget: That was fun.",
"k:",
"- verb: knock",
"  self: You rap yourself smartly on the forehead.  D'oh!",
"l:",
"- verb: laugh",
"  notarget: You laugh out loud!",
"  self: You laugh at yourself.",
"- verb: lean",
"  notarget: You shift your weight.",
"  self: You shift your weight, restlessly leaning back and forth.",
"- verb: leer",
"  notarget: You glance to one side and curl your lips into a lascivious leer.",
"  self: You glance to one side and let your lips curl into a malicious leer.",
"- verb: lick",
"  notarget: You stick out your tongue.",
"- verb: limp",
"  notarget: You limp around a bit, favoring one leg.",
"  self: You limp around in a circle.  How sad!",
"- verb: listen",
"  notarget: You listen, but don't hear anything unusual.",
"  self: You listen carefully to yourself.  Typical.",
"- verb: lower",
"  notarget: You look around for something to lower, but are unable to find anything.",
"  self: You widen your stance and lower your body.",
"m:",
"- verb: march",
"  notarget: You march back and forth, sharply turning at the end of each stride.",
"  self: You march back and forth a bit.",
"- verb: moan",
"  notarget: You moan.",
"- verb: mumble",
"  notarget: You mumble something under your breath.",
"  self: You mumble something under your breath and kick at the ground in frustration.",
"- verb: mutter",
"  notarget: You mutter something inaudible.",
"n:",
"- verb: nod",
"  notarget: You nod.",
"  self: You incline your head.",
"- verb: nuzzle",
"  notarget: You look around for something to nuzzle against, forever alone.",
"  self: You nuzzle your face awkwardly at your shoulder.",
"o:",
"- verb: observe",
"  notarget: You casually observe your surroundings.",
"  self: You turn your thoughts inward, observing your opinion on society and your place within it.",
"p:",
"- verb: pace",
"  notarget: You pace back and forth.",
"- verb: panic",
"  notarget: You gasp in terrified panic, trembling and flailing your arms about!",
"  self: Your eyes widen as you tremble in quiet panic.",
"- verb: pant",
"  notarget: You pant.",
"- verb: pat",
"  notarget: You pat your head, trying to get your hair to fall into place.",
"  self: You place your left hand upon your head and pat it, while simultaneously rubbing your stomach.",
"- verb: pedal",
"  notarget: Lifting first one foot and then another, you slowly backpedal.",
"- verb: pinch",
"  notarget: You hold up two fingers and slowly pinch them together until they are almost touching.",
"  self: You pinch yourself hard.  Yep, definitely still awake.  And ouch.",
"- verb: poke",
"  self: Do you poke yourself often?",
"- verb: ponder",
"  notarget: You ponder.",
"  self: You ponder the meaning of life, the universe, and everything.",
"- verb: pose",
"  notarget: You strike a heroic pose.",
"  self: You preen a bit, glancing down to see if everything is in place, then strike a pose.",
"- verb: pout",
"  notarget: You pout.",
"  self: You whimper as your bottom lip trembles.",
"- verb: prance",
"  notarget: You prance back and forth energetically, taking light, springy steps.",
"  self: You toss up your arms and take a few prancing steps back and forth.",
"- verb: pray",
"  notarget: You mumble a few quick words of blessing for your meal.",
"- verb: preen",
"  notarget: You preen.",
"  self: You lift up your chin and throw back your shoulders.",
"- verb: procrastinate",
"  notarget: You realize there are some important matters you should tend to . . .later.",
"- verb: prod",
"  self: You prod yourself in the ribs with your thumb.",
"- verb: pucker",
"  notarget: You pucker your lips.",
"- verb: puff",
"  notarget: You puff out your chest.",
"  self: You huff and puff, out of breath.",
"- verb: punch",
"  self: Okay, you punch yourself in the side of the head.  Feel better?",
"- verb: punish",
"  self: You beat yourself severely.",
"- verb: purr",
"  notarget: You make a purring sound.",
"  self: You make a low, rumbling sound deep in your throat.",
"- verb: puzzle",
"  notarget: You act puzzled.",
"  self: You feel rather puzzled at the moment.",
"q: []",
"r:",
"- verb: raspberry",
"  notarget: You stick your tongue out and let loose with a loud, Thbtbtbtbt from your lips!",
"  self: You let out an exasperated, Pbpbpb.",
"- verb: redeem",
"  self: You begin to list off your many redeeming qualities.",
"- verb: roar",
"  notarget: You roar!",
"  self: You roar at yourself!",
"- verb: rock",
"  notarget: You rock back on your heels.",
"s:",
"- verb: salute",
"  notarget: You render a sharp hand salute.",
"  self: You mime raising a glass and give a toast to your health.",
"- verb: sashay",
"  notarget: You sashay about gracefully, just enjoying yourself.",
"  self: You sashay about in a circle with your head thrown back and arms wide.",
"- verb: scoff",
"  notarget: You scoff.",
"- verb: scold",
"  notarget: You shake your head, clucking your tongue.",
"  self: You smack your forehead with the palm of your hand!",
"- verb: scowl",
"  notarget: You scowl.",
"  self: You scowl to yourself, muttering a few obscenities under your breath.",
"- verb: scratch",
"  notarget: You scratch yourself where it itches.  That feels better.",
"  self: You scratch yourself under the arm.  Time for a bath, perhaps?",
"- verb: scream",
"  notarget: You scream!",
"  self: You clear your throat.",
"- verb: shiver",
"  notarget: You shiver.",
"- verb: shout",
"  notarget: You let loose with a shout of exultation!",
"- verb: shriek",
"  notarget: You shriek!",
"- verb: shrug",
"  notarget: You shrug.",
"- verb: shudder",
"  notarget: You shudder.",
"- verb: shuffle",
"  notarget: You shuffle your feet.",
"- verb: shun",
"  self: You pointedly ignore your own concerns and move about seeking someone to help.",
"- verb: shush",
"  notarget: You make a shushing sound!",
"  self: You shush yourself!  My my!",
"- verb: sigh",
"  notarget: You sigh.",
"- verb: simper",
"  notarget: You simper.",
"  self: You smile in a silly, self-conscious fashion.",
"- verb: skip",
"  notarget: You skip around in a happy little circle.",
"  self: You skip around in a merry little circle.  How happy you are!",
"- verb: sleep",
"  notarget: You slump to the ground and immediately fall asleep.  You must have been exhausted!",
"- verb: smell",
"  notarget: You sniff.",
"  self: You quietly sniff at yourself.  You *think* you smell okay, but then, doesn't everybody?",
"- verb: smile",
"  notarget: You smile.",
"  self: You smile quietly to yourself.",
"- verb: smirk",
"  notarget: You smirk.",
"  self: You smirk and roll your eyes in disgust.",
"- verb: smooch",
"  notarget: You smack your lips.",
"  self: You bite your lip.",
"- verb: snap",
"  notarget: You snap your fingers.",
"  self: You snap your fingers to a rhythm only you can hear.",
"- verb: snarl",
"  notarget: Ooh!  That felt great!",
"  self: You try to snarl at yourself but end up scrunching up your face instead.",
"- verb: sneer",
"  notarget: You sneer.",
"  self: You sneer to yourself.",
"- verb: sneeze",
"  notarget: You suddenly let out a noise sounding much like a stuck rolton.",
"  self: You sneeze.",
"- verb: snicker",
"  notarget: You snicker.",
"  self: You snicker to yourself.",
"- verb: snore",
"  notarget: You snore quietly, quite bored.",
"  self: You throw your head back and snore loudly and obnoxiously.",
"- verb: snort",
"  notarget: You make a horrendous warthog-like noise.",
"  self: You snort and glance about skeptically.",
"- verb: sob",
"  notarget: You sob.",
"- verb: spin",
"  self: You spread your arms out wide and spin around in a circle!",
"- verb: squeal",
"  notarget: You squeal.",
"  self: You let out a little squeal of delight.",
"- verb: squint",
"  notarget: You squint.",
"  self: You narrow your eyes.",
"- verb: squirm",
"  notarget: You squirm.",
"  self: You squirm in place.",
"- verb: stare",
"  notarget: You stare at nothing in particular.",
"  self: Your eyes glaze over as you stare, unfocused, into the distance.",
"- verb: steeple",
"  notarget: You steeple your fingers, quietly observing your surroundings.",
"  self: You glance at your fingers and steeple them together.",
"- verb: stomp",
"  notarget: You stamp your feet.",
"  self: You impatiently stamp your feet.",
"- verb: stretch",
"  notarget: You stretch.",
"- verb: stride",
"  notarget: You stride a few steps forward.",
"  self: You take a few steps in a small circle.",
"- verb: strut",
"  notarget: You strut about.",
"- verb: stumble",
"  notarget: You suddenly stumble for no apparent reason.",
"  self: You get your legs tangled and nearly tip over!",
"- verb: sulk",
"  notarget: You begin to mope around, feeling very sorry for yourself.",
"  self: You wrap your arms around yourself with a despondent sulk.",
"- verb: surrender",
"  notarget: You raise your hands in surrender!",
"  self: You raise your hands toward the sky in surrender!",
"- verb: sway",
"  notarget: You sway back and forth.",
"- verb: swear",
"  notarget: You let out an eloquently vile series of grunts.",
"  self: You grunt out an eloquent description of yourself.",
"- verb: sweat",
"  notarget: You break out in a sweat.",
"  self: You tense, beads of sweat forming on your brow.",
"- verb: swoon",
"  notarget: My, my, aren't we dramatic today?",
"  self: Your eyes suddenly roll up into your head and you fall to the ground in a heap!",
"t:",
"- verb: tap",
"  notarget: You tap your foot impatiently.",
"  self: You tap yourself on the chest.",
"- verb: tinker",
"  notarget: You look for something to tinker with.",
"  self: You tinker with your appearance.",
"- verb: tremble",
"  notarget: You tremble.",
"  self: You shift your weight, trembling slightly.",
"- verb: trudge",
"  notarget: You trudge back and forth.",
"- verb: tuck",
"  notarget: You tuck your arms into your chest and shrug innocently.",
"- verb: turn",
"  self: You turn around.",
"- verb: twiddle",
"  notarget: You twiddle your thumbs.",
"- verb: twitch",
"  notarget: You feel that nervous twitch starting up again.",
"u: []",
"v: []",
"w:",
"- verb: waggle",
"  self: You waggle your fingers mystically.",
"- verb: wail",
"  notarget: You wail!",
"- verb: wake",
"  self: You smack yourself across the cheek in an attempt to rouse yourself!",
"- verb: warble",
"  notarget: You warble like a bird.",
"- verb: watch",
"  notarget: You survey your surroundings carefully, looking for any untoward activities.",
"- verb: wave",
"  notarget: You wave.",
"  self: You fan yourself.",
"- verb: weight",
"  notarget: You carefully examine your physique and figure you weigh about 214 pounds.",
"- verb: wheeze",
"  notarget: You wheeze, trying to catch your breath.",
"- verb: whimper",
"  notarget: Poor baby!",
"  self: You let out a loud whimper!",
"- verb: whine",
"  notarget: How can they be so mean to you?!",
"- verb: whistle",
"  notarget: You whistle tunelessly to yourself, remembering days past.",
"  self: You whistle a jaunty tune and glance about the area.",
"- verb: wince",
"  notarget: You furrow up your face and wince.",
"- verb: wink",
"  notarget: You wink.",
"  self: You try to wink at yourself, but end up looking like you have something in your eye.",
"- verb: wobble",
"  notarget: You feel a bit weak in the knees and find yourself wobbling.",
"x: []",
"y:",
"- verb: yell",
"  notarget: You let loose a mighty shout!",
"  self: You quell a shout rising in your throat.",
"z: []",
"aelotoi:",
"- verb: blink aelotoi",
"  self: Shutting your eyes, you close off your mind to the world around you, grateful for the silence.",
"- verb: bow wings",
"  notarget: You bow low, spreading your wings for all to see.",
"- verb: flap aelotoi",
"  notarget: You flap your wings in a steady beat.",
"  self: You give your wings a rapid shiver.",
"- verb: flutter aelotoi",
"  notarget: You flutter your wings creating a gentle breeze about yourself.",
"- verb: flutter afraid",
"  notarget: You flutter your wings and cower back a little bit.",
"- verb: flutter angry",
"  notarget: You flutter your wings and scowl.",
"- verb: flutter annoyed",
"  notarget: You flutter your wings and end it by sharply snapping them to your body.",
"- verb: flutter bashful",
"  notarget: You flutter your wings gently as your cheeks blush soft pale rose.",
"- verb: flutter bored",
"  notarget: You lazily flutter your wings.",
"- verb: flutter calm",
"  notarget: You calmly flutter your wings in time to some unheard music.",
"- verb: flutter crazy",
"  notarget: You flutter your wings wildly as if they were on fire.",
"- verb: flutter flashy",
"  notarget: You flutter your wings, flashing them for all to see.",
"- verb: flutter happy",
"  notarget: You flutter your wings while bouncing in place happily.",
"- verb: flutter nervous",
"  notarget: Your wings flutter with a slight trembling in them.",
"- verb: flutter scared",
"  notarget: You flutter your wings, trying to hide behind them.",
"- verb: flutter tired",
"  notarget: You flutter your wings momentarily, before letting them droop.",
"- verb: fold wings",
"  notarget: You fold your wings across your back.",
"- verb: glare aelotoi",
"  notarget: You narrow your eyes to mere slits.",
"- verb: preen aelotoi",
"  notarget: You preen your wings.",
"  self: You lift up your chin and straighten out your wings.",
"- verb: snap wings",
"  notarget: You feel a fleeting shiver roll through the base of your (color) wings, and you flick them abruptly in response.",
"  self: You idly flick your (color) wings for a few moments and sleekly rest them against your back.",
"- verb: stare aelotoi",
"  notarget: You fully extend your wings and cautiously study your surroundings.",
"- verb: stretch wings",
"  notarget: You stretch, flexing your wings.",
"- verb: twitch aelotoi",
"  notarget: You twitch your wings ever so slightly.",
"- verb: wave wings",
"  notarget: You gently fan your (color) wings.",
"  self: You fan your (color) wings, stirring up a small breeze about yourself. Refreshing!",
"burghal gnome:",
"- verb: tinker burgh",
"  notarget: You search for something worth tinkering with.",
"  self: You methodically tinker with each one of your belongings.",
"dark elf:",
"- verb: point dark",
"  self: You find you are exceedingly pleased with yourself.",
"- verb: raise eyebrow dark",
"  notarget: You arch a skeptical eyebrow, pondering whether your amusement with the world outweighs your disgust.",
"- verb: smirk dark",
"  notarget: You smirk as a haughty expression flits across your face.",
"  self: You purse your lips in disapproval.",
"- verb: stare dark",
"  self: You turn your head slightly to the side and stare purposefully off into the distance.",
"- verb: steeple anger",
"  notarget: You lace your fingers before you, your knuckles turning white as you try to control your rage.",
"- verb: steeple arrogant",
"  notarget: Grinning arrogantly, you lace your fingers together and square your shoulders in righteous indignation.",
"- verb: steeple back",
"  notarget: You lace your fingers behind your back and stand at rigid attention.",
"- verb: steeple evil",
"  notarget: You steeple your fingers slowly as a smirk plays across your lips.",
"- verb: steeple head",
"  notarget: You lace your fingers together and place them behind your head, raising one eyebrow in slight annoyance.",
"- verb: steeple listen",
"  notarget: Tensing your body, you lace your fingers together as you listen quietly.",
"- verb: steeple ponder",
"  notarget: Deep in thought, you lace your fingers before you.",
"dwarf:",
"- verb: belch deep",
"  notarget: A low guttural belch rumbles from your mouth.",
"- verb: belch drunk",
"  notarget: You belch drunkenly, a goofy smile plastered on your face.",
"- verb: belch explode",
"  notarget: You let loose with an explosive belch.",
"- verb: belch hearty",
"  notarget: You belch heartily, feeling satisfied.",
"- verb: belch juicy",
"  notarget: You belch juicily, wiping the gastric secretions from your chin.",
"- verb: belch lazy",
"  notarget: You let out a loud belch as you lazily scratch your backside.",
"- verb: belch long",
"  notarget: You release a long, drawn out belch. Impressive.",
"- verb: belch loud",
"  notarget: You belch lustily, reeking of garlic and ale.",
"- verb: belch quick",
"  notarget: You give a quick belch.",
"- verb: belch relief",
"  notarget: You belch loudly, feeling an immediate sense of relief.",
"- verb: belch rolton",
"  notarget: You belch, sounding suspiciously like an angry rolton.",
"- verb: belch soft",
"  notarget: You belch softly.",
"- verb: belch strongly",
"  notarget: A thunderous belch explodes from your mouth, filling the air with the stench of rancid cheese.",
"- verb: belch talk",
"  notarget: You open your mouth to speak, but an unexpected belch interrupts you.",
"- verb: belch under",
"  notarget: You belch under your breath, trying to avoid notice.",
"- verb: belch vomit",
"  notarget: You belch forcefully, giving a quick swallow as you feel your gorge rise.",
"- verb: grunt agree",
"  notarget: You grunt in agreement.",
"- verb: grunt amused",
"  notarget: You grunt, amused.",
"- verb: grunt anger",
"  notarget: You grunt angrily.",
"- verb: grunt annoy",
"  notarget: You grunt in annoyance.",
"- verb: grunt bashful",
"  notarget: You grunt bashfully.",
"- verb: grunt bored",
"  notarget: You grunt, bored.",
"- verb: grunt bye",
"  notarget: You grunt in farewell.",
"- verb: grunt crazy",
"  notarget: You grunt oddly, rolling your eyes and sticking your tongue out. Loon.",
"- verb: grunt drink",
"  notarget: You grunt, motioning for a drink.",
"- verb: grunt drunk",
"  notarget: You grunt drunkenly.",
"- verb: grunt elf",
"  notarget: You grunt in obvious distaste.",
"- verb: grunt fear",
"  notarget: You grunt in fear and surprise!",
"- verb: grunt fierce",
"  notarget: You grunt fiercely!",
"- verb: grunt food",
"  notarget: You grunt hungrily.",
"- verb: grunt fool",
"  notarget: You grunt in annoyance.",
"- verb: grunt gem",
"  notarget: You grunt, thinking greedily of gems!",
"- verb: grunt glee",
"  notarget: You grunt gleefully, rubbing your hands together!",
"- verb: grunt greedy",
"  notarget: You grunt greedily!",
"- verb: grunt grimly",
"  notarget: You grunt grimly.",
"- verb: grunt happy",
"  notarget: You grunt happily.",
"- verb: grunt hello",
"  notarget: You grunt in greeting.",
"- verb: grunt help",
"  notarget: You grunt, calling for aid!",
"- verb: grunt hunger",
"  notarget: You grunt in hunger.",
"- verb: grunt maybe",
"  notarget: You grunt noncommittally.",
"- verb: grunt menace",
"  notarget: You grunt menacingly!",
"- verb: grunt mine",
"  notarget: You grunt possessively!",
"- verb: grunt no",
"  notarget: You grunt negatively.",
"- verb: grunt pain",
"  notarget: You grunt in pain.",
"- verb: grunt sad",
"  notarget: You grunt sadly.",
"- verb: grunt sleepy",
"  notarget: You grunt sleepily.",
"- verb: grunt stupid",
"  notarget: You grunt, grinning stupidly.",
"- verb: grunt thanks",
"  notarget: You grunt in thanks.",
"- verb: grunt tired",
"  notarget: You grunt tiredly.",
"- verb: grunt what",
"  notarget: You grunt in annoyance!",
"- verb: grunt yes",
"  notarget: You grunt in affirmation.",
"- verb: grunt question",
"  notarget: You grunt questioningly.",
"- verb: grunt satisfied",
"  notarget: You grunt with satisfaction!",
"- verb: grunt skeptical",
"  notarget: You grunt skeptically.",
"- verb: grunt thoughtful",
"  notarget: You grunt pensively.",
"- verb: grunt easter egg",
"  notarget: You grunt proudly, in honor of a fine man.",
"- verb: swear eloquent",
"  notarget: You let out an eloquently vile series of grunts.",
"elf:",
"- verb: belch elf",
"  notarget: You belch softly, the tips of your ears turning pink with embarrassment.",
"- verb: disdain elf",
"  notarget: You stare around the room, a haughty expression on your face.",
"- verb: disdain gaze",
"  notarget: You gaze around the room, a haughty expression on your face.",
"- verb: disdain glance",
"  notarget: You glance around the room, running a finger up and over the point of your ear, purposely trying to draw attention to it.",
"- verb: disdain glare",
"  notarget: You stare around the room, one eyebrow arched in an arrogant, but quizzical, expression.",
"- verb: disdain stare",
"  notarget: You stare down your nose, haughtily surveying the room.",
"- verb: disdain blank",
"  notarget: You stare blankly around the room, your face utterly devoid of emotion.",
"erithian:",
"- verb: wait erithian",
"  notarget: You stand perfectly still, like a slender reed on a windless day.",
"  self: You patiently wait, measuring each beat of passing time.",
"- verb: pose erithian",
"  notarget: You steady your breathing and slowly stretch out each of your limbs in turn, preparing ourself for activity.",
"- verb: ponder erithian",
"  notarget: You pause in a moment of thoughtful contemplation.",
"  self: You close your eyes for a moment and slip into a brief contemplative trance. You reflect upon your circumstances and recent past, searching for any lessons you might learn from them.",
"- verb: stretch mountain",
"  notarget: Gracefully bending at the waist, you place your palms and wrists on the ground in front of you, extending the pose forward until your body forms a perfect mountain peak.",
"- verb: stretch tree",
"  notarget: Extending your arms straight up over your head, you draw one leg up towards the center of your body, balancing lightly on your remaining leg.",
"- verb: stretch hawk",
"  notarget: You fold your left leg beneath you, extending your right leg behind you fully. Raising your arms overhead you arch your back, easing the tension in your spine.",
"- verb: stretch diamond",
"  notarget: Drawing your legs together in front of you, you position your heels and toes against each other, forming a diamond.",
"- verb: stretch wave",
"  notarget: You fold your hands deliberately over your chest and then arch your back until your neck and spine form a perfect arch. Elevating your legs evenly, you perform the precise wave posture.",
"- verb: stretch moon",
"  notarget: Balancing on your stomach you extend your arms above and behind you, grasping your ankles. Drawing your limbs upward, your body forms a complete circle.",
"- verb: stretch child",
"  notarget: You slide your hands along the floor away from you as you bend forward, bringing your torso to rest between your out-turned knees. You place your forehead on the floor and relax into the posture.",
"- verb: stretch camel",
"  notarget: Sitting up on your knees, you reach both arms behind you and place your open palms on your flexed feet. You stretch your heart upward, bowing your back as you gaze up at the ceiling.",
"- verb: bow cross",
"  notarget: Crossing your arms over your chest, palms flat against each shoulder, you bow.",
"- verb: bow deeply",
"  notarget: You bow deeply.",
"- verb: bow floor",
"  notarget: You bow from the waist in a fluid movement, touching your forehead to the floor.",
"- verb: bow hands",
"  notarget: Folding your hands together, you bow shallowly from the waist.",
"- verb: bow fold",
"  notarget: Folding your hands together, you bow shallowly from the waist.",
"- verb: bow gracefully",
"  notarget: You bow with sweeping grace, like a hawk gliding on the wind.",
"- verb: bow recognition",
"  notarget: Nodding slightly, you bow an acknowledgement.",
"forest gnome:",
"- verb: tinker forest",
"  notarget: You ponder on the philosophical aspects of your environment and consider the potential ecological consequences of your surroundings.",
"- verb: salute forest",
"  notarget: Snapping your heels together, you stiffen your upper body, left arm pressed tight against your side, and salute.",
"  self: You wave your hands back and forth, one over the other, in a definitive negative motion.",
"- verb: observe forest",
"  notarget (outside): Crouching low to the ground, you scan your immediate surroundings with a keen eye and a skilled hand. Once convinced there are no environmental traps, you slap your hand against your thigh decisively.",
"  self: You mouth a few words silently while trying to imitate speech patterns.",
"- verb: wink forest",
"  notarget: With your mouth agape, you execute a slow, exaggerated wink and then roll your eyes dramatically.",
"  self: You squeeze your eyes shut and shake your head in disbelief.",
"- verb: fidget forest",
"  notarget: You rub your hands together briskly as you scrutinize your surroundings.",
"  self: You fidget nervously as you glance around the area, clearly uncomfortable with the lack of vegetation.",
"giantman:",
"- verb: pound angrily",
"  notarget: Giant glances around, looking angry, then pounds one of her fists into the other a few times.",
"- verb: pound contemptuously",
"  notarget: Giant pounds one of her fists into the other, then shakes her head contemptuously.",
"- verb: pound halfheartedly",
"  notarget: Giant lightly pounds one of her fists into the other. Not very threatening.",
"- verb: pound loudly",
"  notarget: Giant heavily pounds one of her fists into the other, producing a loud clap.",
"- verb: pound nervously",
"  notarget: Giant glances over her shoulders nervously, then silently pounds one fist into the other.",
"- verb: pound slowly",
"  notarget: Giant slowly and deliberately pounds one of her fists into the other.",
"half-elf:",
"- verb: cower half",
"  notarget: You stumble back a few steps as you duck your head and throw your arm up in a protective gesture.",
"  self: You suddenly cower and raise your arm in a defensive reflex, then slowly straighten up again feeling slightly mortified as you realize you are not being threatened.",
"- verb: fidget anxious",
"  notarget: You fidget anxiously, glancing around with a troubled look on your face.",
"- verb: fidget excited",
"  notarget: You fidget excitedly, rubbing your hands together.",
"- verb: fidget annoyed",
"  notarget: You fidget while glancing back and forth quickly, trying to look annoyed.",
"- verb: fidget nervous",
"  notarget: You fidget nervously as beads of sweat begin to form on your brow.",
"- verb: fidget concern",
"  notarget: You fidget uneasily, looking around with concern.",
"- verb: observe half",
"  notarget: You narrow your eyes and take in your surroundings as you are overwhelmed with feelings of bitterness.",
"  self: You tighten your lips in a bitter half-smile.",
"- verb: pose elven",
"  notarget: You hold yourself up straighter and inhale, striking your most refined pose in an attempt to look a little bit more lithe and hopefully more elven.",
"- verb: pose human",
"  notarget: You take a deep breath and throw your shoulders back while slightly jutting out your chin, striking a proud pose in a hopeful attempt to look more human.",
"- verb: sneer half",
"  notarget: You sneer with a hint of underlying anger bleeding through, almost daring anyone to mess with you.",
"- verb: sulk half",
"  notarget: You cast your eyes downward while tugging self-consciously at the tip of your ear.",
"half-krolvin:",
"- verb: bristle half",
"  self: You turn your head slightly and tense up, forcing the hair on your body to go stiff.",
"- verb: bristle anxious",
"  notarget: You glance around, bristling with anxiety.",
"- verb: bristle excited",
"  notarget: You bristle with excitement!",
"- verb: bristle happy",
"  notarget: You give a bright yelp of laughter and bristle with happiness.",
"- verb: bristle impatient",
"  notarget: You bristle impatiently.",
"- verb: bristle nervous",
"  notarget: You bristle nervously.",
"- verb: bristle proud",
"  notarget: You hold yourself in dignified silence, bristling with pride.",
"- verb: bristle satisfied",
"  notarget: You stretch slowly, bristling with satisfaction.",
"- verb: bristle sleepy",
"  notarget: You stretch lazily, bristling as you suppress a yawn.",
"- verb: bristle smug",
"  notarget: You bristle smugly.",
"- verb: roar angry",
"  notarget: You bare your fangs and roar angrily!",
"- verb: roar hungry",
"  notarget: Pointing to your mouth, you roar hungrily!",
"- verb: roar loudly",
"  notarget: You take a deep breath and level a deafening roar!",
"- verb: roar pain",
"  notarget: Wincing with pain, you let out a roar!",
"- verb: roar triumph",
"  notarget: You throw back your head and let loose with a roar of triumph!",
"- verb: roar fear",
"  notarget: Quivering in fear, you let out a tentative roar!",
"halfling:",
"- verb: dance halfl left",
"  notarget: Placing your hands upon your hips, you perform a quick heel-to-toe dance that ends with two high hops to the left.",
"- verb: dance halfl right",
"  notarget: Placing your hands upon your hips, you perform a quick heel-to-toe dance that ends with two high hops to the right.",
"- verb: bow halfl",
"  notarget: Folding your left arm behind your back and dipping to one knee, you bow respectfully and incline your head.",
"- verb: curtsy halfl",
"  notarget: Folding your left arm behind your back and dipping to one knee, you bow respectfully and incline your head.",
"- verb: duck halfl",
"  notarget: You quickly duck to the side and out of the way.",
"- verb: fold halfl",
"  notarget: Firmly planting your feet equidistance apart, you fold your arms and lift your head in a defiant manner.",
"- verb: sit halfl",
"  notarget: Crossing your legs at the ankles, you slowly lower yourself to the ground and sit tailor fashion.",
"- verb: crack toes",
"  notarget: Lifting your right foot, you bend your big toe downward and apply pressure. A sigh of relief escapes your lips as you are rewarded with a loud crack. Standing tall, you repeat the process with the left and relish the moment.",
"- verb: impose halfl",
"  notarget: You pull back your shoulders, stretch your neck and rise up on your toes in an attempt to appear more imposing.",
"human:",
"- verb: bow contempt",
"  notarget: You make a contemptuous half-bow.",
"- verb: bow grand",
"  notarget: Sweeping your arm outward, you bow low in a grand fashion.",
"- verb: bow mock",
"  notarget: You bow mockingly, your every move a grotesque exaggeration.",
"- verb: bow respect",
"  notarget: Fixing your eyes firmly on the ground, you bow respectfully.",
"- verb: bow submissive",
"  notarget: You bow low, abasing yourself before all.",
"- verb: curtsy contempt",
"  notarget: Dropping into a stiff curtsy, your lips curl into a contemptuous sneer.",
"- verb: curtsy grand",
"  notarget: You drop into a deep curtsy, moving smoothly as your arms sweep grandly to your sides.",
"- verb: curtsy mock",
"  notarget: A haughty smirk pulls your lips as you dip into a graceful, yet mocking curtsy.",
"- verb: curtsy respect",
"  notarget: You bow your head slightly as you drop into a deep, respectful curtsy.",
"- verb: curtsy submissive",
"  notarget: Crossing your arms behind your back, you fall into a deep and graceful curtsy that nearly leaves you on the floor.",
"- verb: shrug human",
"  notarget: You shrug your shoulders a few times, rolling your torso from side as you loosen up the muscles along your upper back.",
"sylvankind:",
"- verb: listen sylvan",
"  self: You listen quietly to the sounds of nature all around you, letting your heartbeat slow to join in perfect time with the pulsating rhythm of life.",
"- verb: observe sylvan",
"  notarget: You observe your surroundings carefully, taking in every last detail.",
"  self: You observe your own condition, expanding your awareness of yourself as a part of your environment.",
"- verb: observe doubt",
"  notarget: Looking around, you can't help but feel that something is wrong with your surroundings.",
"- verb: observe enemy",
"  notarget: You look around, every sense on the alert for possible foes.",
"- verb: observe life",
"  notarget: You look around, taking note of all the signs of life nearby.",
"- verb: observe life creatures",
"  notarget: You look around, and can't help but focus on the creatures nearby.",
"- verb: observe quick",
"  notarget: You quickly scan your surroundings, taking keen note of the flora and fauna in the area.",
"- verb: observe slow",
"  notarget: You observe your surroundings very slowly, not wanting to miss a single detail.",
"- verb: observe ground",
"  notarget: You observe the ground, searching for tracks.",
"- verb: observe sky ",
"  notarget: You look up at the sky, taking note of the position of the sun.",
"- verb: observe air",
"  notarget: You observe every detail of the air, from its scent to its direction to its ambient temperature.",
"- verb: observe environment",
"  notarget: You observe the comfortingly natural feel of your environment.",
"- verb: observe escape",
"  notarget: You look around for possible escape routes.",
"icemule trace:",
"- verb: rub icemule",
"  self: As a brisk wind rushes through the area, you quickly rub your hands together for warmth, warding off the chill.",
"- verb: shiver icemule",
"  notarget: A slight shiver courses through your body as you shake off the cold.",
"  self: You huddle down against yourself in an attempt to warm up.",
"- verb: swoon icemule",
"  person: As you take a step forward, you suddenly lose your footing on the icy ground! You flail wildly as you attempt to steady yourself, but land sprawled out in front of <person> with a painful *WHUMP*!",
"  creature: As you take a step forward, you suddenly lose your footing on the icy ground! You flail wildly as you attempt to steady yourself, but land sprawled out in front of <creature> with a painful *WHUMP*!",
"  held: As you take a step forward, you suddenly lose your footing on the icy ground! You flail wildly as you attempt to protect your <object> from the fall and land on your rear with a painful *WHUMP*!",
"  room_object: As you take a step forward, you suddenly lose your footing on the icy ground! You flail wildly as you attempt to steady yourself, but land sprawled out in front of <object> with a painful *WHUMP*!",
"  container_object: As you take a step forward, you suddenly lose your footing on the icy ground! You flail wildly as you attempt to steady yourself, but land sprawled out and staring at <target> with a painful *WHUMP*!",
"- verb: touch icemule",
"  notarget: With a shiver, you rub each hand across the opposite forearm, trying to get warm.",
"kharam dzu:",
"- verb: panic dzu",
"  notarget: You suddenly feel nervous and instinctively glance in the direction of Ghorsa Tower. Was that the gong?",
"  self: Your palms start to sweat as panic sets in. Somebody should go ring the gong!",
"- verb: dust dzu",
"  self: You rub your hands together compulsively.",
"mist harbor:",
"- verb: smooch mist",
"  notarget: Delicious, delectable, and scrumptious are just a few of many words that cross your mind as you loudly kiss your joined fingertips before splaying them in front of you in an expression of appreciation.",
"  self: You open your mouth to speak. After remaining silent for a pregnant moment, you close your mouth again, brow furrowed.",
"- verb: slap mist",
"  self: Turning your palm outward, you put your hand to your forehead in a mock swoon.",
"- verb: slap mist annoy",
"  self: You bury your face in your palm, feeling highly annoyed.",
"- verb: slap mist defeat",
"  self: You sigh and lower your head into your waiting palm.",
"- verb: slap mist embarrass",
"  self: You bury your reddening face in your palm, groaning at your current state of embarrassment.",
"- verb: slap mist forget",
"  self: Suddenly remembering something, you gasp aloud and slap yourself on the forehead.",
"- verb: slap mist frustrate",
"  self: You bury your face in your palm, shaking your head in frustration at your present circumstances.",
"- verb: laugh mirth",
"  notarget: Your shoulders shake subtly as you struggle to conceal your expression of mirth.",
"- verb: laugh raucous",
"  notarget: You burst into raucous laughter, losing your balance and almost falling to the ground before you catch yourself.",
"- verb: stretch arm mist",
"  notarget: You swing your arm about, and while there might be a few pops, it still seems to work.",
"- verb: stretch hand mist",
"  notarget: You clench your hand repeatedly, ensuring all the fingers still work as they should.",
"- verb: stretch neck mist",
"  notarget: You slowly move your head around, trying to remove any stiffness from your neck.",
"- verb: stretch toes mist",
"  notarget: You flex your toes to make sure none of them are broken.",
"river\'s rest:",
"- verb: fly rest",
"  notarget: You flap your arms and let out a harsh scream, imitating a blood eagle.",
"  self: Doing your best imitation of a newcomer's first encounter with a blood eagle, you windmill your arms, let out an ear-piercing shriek, and topple to the ground with a thud.",
"- verb: glance rest",
"  self: You glance over yourself, making sure you are a presentable River Rat.",
"- verb: mumble rest",
"  self: You mumble something about imperial taxes and revolution.",
"- verb: raise rest",
"  notarget: You raise your <drink> in a toast to River's Rest!",
"- verb: snort rest",
"  notarget: You start to snorfle, but you inhale as you do and plummet into a coughing fit!",
"- verb: whistle rest",
"  self: You whistle a carefree tune, the perfect picture of innocence.",
"solhaven:",
"- verb: fold solhaven",
"  notarget: You fold your arms over your chest in a display of stubborn pride, tilting your chin up slightly in defiance. Kraken, floods, apocalypses, cats... really, what could possibly think it has the power to scare you any more?",
"- verb: pinch solhaven",
"  notarget: You curl your hands into a facsimile of lobster claws, making exaggerated pinchy motions at the air around you while clicking your tongue to provide the snapping sounds of the claws closing.",
"ta\'illistim:",
"- verb: curtsy illistim",
"  notarget: Straightening your back, you give a formal, low curtsy. In time with your greater movement, you incline your head as well in a brief nod.",
"- verb: ponder illistim",
"  notarget: Oh, to only have the right book at hand!",
"  self: You pause to consider recent events, and your place in them.",
"- verb: salute illistim",
"  notarget: With your face alight with pride, you cry out in elven, Bless the Shining City!",
"- verb: scold illistim",
"  notarget: How uncouth!",
"  self: You berate yourself for a complete lack of forethought.",
"- verb: turn illistim",
"  notarget: You turn around to avoid anyone seeing your look of consternation.",
"  self: You give a short glance over your shoulder.",
"ta\'vaalor:",
"- verb: giggle vaalor",
"  notarget: Just as you are about to giggle you remember that soldiers don't act like schoolgirls.",
"- verb: salute vaalor",
"  notarget: You snap to attention and strike your chest with a closed fist.",
"  self: You snap to attention and strike your chest with a closed fist, practicing your form.",
"- verb: scream vaalor",
"  notarget: You bolster your morale with a Vaalor call to arms, belting out in elven, For Honor, Pride, and Glory!",
"- verb: turn vaalor",
"  notarget: You turn in a slow, precise circle, assessing your surroundings from every direction.",
"  self: You turn sharply on your heel, reversing direction with military precision.",
"wehnimer\'s landing:",
"- verb: nudge landing",
"  notarget: You push forward purposefully, letting nothing and no one stand in your way!",
"- verb: ponder landing",
"  notarget: You place your hands on your hips and casually survey your surroundings.",
"  self: You eye the surroundings with a skeptical look.",
"premium:",
"- verb: express boredom",
"  notarget: You cast about for something to occupy your mind, staring about aimlessly as your mind wanders.",
"- verb: express despair",
"  notarget: You cry out in despair, tears streaming down your face.",
"- verb: express disregard",
"  notarget: You peruse the area around you and disregard it all as clearly well beneath your notice, turning your gaze to the middle distance.",
"- verb: express drift",
"  notarget: You close your eyes and let your mind wander down whatever tangents it likes, drifting along the pathways of undirected thoughts.",
"- verb: express elation",
"  notarget: You hug yourself and grin so wide you feel like your lips will crack while you emit a high-pitched squeal.",
"- verb: express exasperation",
"  notarget: You close your eyes and slap one hand against your face, sliding it down your features in an attempt to wipe away the deep-seated frustration welling up inside.",
"- verb: express fortify",
"  notarget: You take a series of rapid short breaths, square your shoulders, throw out your chin, and prepare to meet the challenges that lie ahead.",
"- verb: express frolic",
"  notarget: A wild energy suffuses your body, and you dart about the immediate area, doing your best to embody a particularly giddy squirrel.",
"- verb: express gut",
"  notarget: You feel an uncomfortable sensation deep in your bowels, then take a careful look around. You lean slightly to one side and allow the discomfort to pass naturally, watching carefully to see if you're noticed.",
"- verb: express mope",
"  notarget: You let your shoulders fall along with all the muscles in your face. You paste on your best hangdog expression and generally feel awful for yourself.",
"- verb: express murder",
"  notarget: You clench your teeth as your vision starts to swim with crimson hues. A deep, burning rage builds within your gut, and you clench your fists as thoughts of carnage fill your mind. Unbidden, a low growl burbles up from deep within your chest.",
"- verb: express overcome",
"  notarget: Overcome, you lay your wrist upon your forehead with a tiny gasp and sink delicately to the floor.",
"- verb: express pine",
"  notarget: You close your eyes momentarily and cast your thoughts back in time, momentarily losing yourself in poignant memories of days gone by.",
"- verb: express rage",
"  notarget: You throw your head back and open your mouth widely, letting loose an earsplitting howl of rage.",
"- verb: express shock",
"  notarget: You drop your jaw in utter shock. You knew exactly what would happen and somehow you're still surprised.",
"- verb: express thanks",
"  notarget: You press your hands together in a praying gesture and bow your head ever so slightly, indicating your thanks.",
"loenthra:",
"- verb: gaze",
"  notarget: You pause and give thoughtful consideration to your surroundings, taking in all the facets of their aesthetic composition.",
"  self: Your gaze grows distant as you lose yourself to the thoughtful consideration of your next artistic endeavor.",
"fanspeak:",
"- verb: agree",
"  notarget: You flick your open aqilorn fan up and down by your side, indicating that you agree.",
"- verb: ally",
"  notarget: You touch your open aqilorn fan to your right cheekbone, indicating that you are an ally.",
"- verb: attention",
"  notarget: You flick your index finger against the rightmost blade of your open aqilorn fan, indicating that you want attention.",
"- verb: attentionwho",
"  notarget: You flick your index finger against your closed aqilorn fan, indicating that you want to know who is paying attention.",
"- verb: busy",
"  notarget: You flip your open aqilorn fan in the air and catch it in the palm of your hand, indicating that you are busy.",
"- verb: careful",
"  notarget: You tap your open aqilorn fan to your nose, indicating that there is a need to be careful.",
"- verb: changesubject",
"  notarget: You hold your open aqilorn fan horizontally and brush your pinky across all of the slats, indicating that you want the subject changed.",
"- verb: comehere",
"  notarget: You brush your open aqilorn fan against the inside of your right arm, indicating that you want people to come with you.",
"- verb: courtesan",
"  notarget: You slide your closed aqilorn fan fan between your middle and ring fingers on the left hand, indicating that you are a courtesan.",
"- verb: danger",
"  notarget: You flick your open aqilorn fan to face to the ground, then snap it upright and closed as you tap it three times on your opposite wrist, indicating that danger is near.",
"- verb: disagree",
"  notarget: You flick your closed aqilorn fan back and forth by your side, indicating that you disagree.",
"- verb: distaste",
"  notarget: You hold your open aqilorn fan to your mouth with the back of your hand toward you, then let your wrist bend forward and cause the fan to droop downward, indicating that you find the current situation distasteful.",
"- verb: distraction",
"  notarget: You flip your open aqilorn fan in the air and catch it in the palm of your hand, indicating that you need a distraction.",
"- verb: iunderstand",
"  notarget: You touch the open fan to your right eyebrow, indicating that you understand.",
"- verb: dontunderstand",
"  notarget: You turn your head to the right and run the tip of your closed aqilorn fan along your left jawline, indicating that you don't understand.",
"- verb: enemy",
"  notarget: You close your aqilorn fan and lower it to your side, grasping it by the wrong end, indicating that you are an enemy.",
"- verb: nearenemy",
"  notarget: You close your aqilorn fan and lower it to your side, grasping it by the wrong end, and tap it against your thigh three times, indicating that an enemy is near.",
"- verb: goaway",
"  notarget: You brush your closed aqilorn fan against the inside of your left arm, indicating that you want people to go away.",
"- verb: goodjob",
"  notarget: You tuck the tip of your closed aqilorn fan under your chin, indicating that you think the right thing was done.",
"- verb: help",
"  notarget: You flick your open aqilorn fan upward, indicating that you need help.",
"- verb: hurry",
"  notarget: You brush your open aqilorn fan against the inside of your left arm, indicating that you need urgency.",
"- verb: leave",
"  notarget: You brush your fingers along your closed aqilorn fan, indicating that it is time to leave.",
"- verb: lying",
"  notarget: You flick your closed aqilorn fan down and brush your right wrist with the blades, indicating that someone is lying.",
"- verb: imlying",
"  notarget: You touch the tip of your closed aqilorn fan to your lips, indicating that you are lying.",
"- verb: trust",
"  notarget: You touch your open aqilorn fan to your left cheekbone, indicating that you question your placement of trust.",
"- verb: truth",
"  notarget: You flick your closed aqilorn fan down and brush your left wrist with the blades, indicating that it's the truth.",
"- verb: imtruth",
"  notarget: You touch the tip of your closed aqilorn fan to the middle of your forehead, indicating that you are telling the truth.",
"- verb: meettomorrow",
"  notarget: You trace the three innermost slats of your open aqilorn fan with your fingertips from the tips to the pivot point, indicating that you want to meet tomorrow.",
"- verb: meettonight",
"  notarget: You trace the two innermost slats of your open aqilorn fan with your fingertips from the tips to the pivot point, indicating that you want to meet tonight.",
"- verb: meetnow",
"  notarget: You trace the center slat of your open aqilorn fan with your fingertips from the tip to the pivot point, indicating that you want to meet now.",
"- verb: 'no'",
"  notarget: You flick your closed aqilorn fan side to side, indicating that you mean no.",
"- verb: dontknow",
"  notarget: You run the edge of your closed aqilorn fan across underside of your left wrist, indicating that you don't know.",
"- verb: overheard",
"  notarget: You flick your open aqilorn fan down and brush your left wrist with it, indicating that you are being overheard.",
"- verb: poison",
"  notarget: You gently brush your right eyebrow with the tip of your closed aqilorn fan, indicating that the food and drink is poisoned.",
"- verb: playalong",
"  notarget: You fold your hands in front of you with your open aqilorn fan covering your right hand, indicating that you'll play along.",
"- verb: silence",
"  notarget: You hold your open aqilorn fan over your right shoulder vertically, covering your right ear, indicating that you need silence.",
"- verb: time",
"  notarget: You brush your open aqilorn fan against the your left side, indicating that now is the time.",
"- verb: thankyou",
"  notarget: You tap your closed aqilorn fan against your cheek, indicating that you are thankful.",
"- verb: wait",
"  notarget: You brush your open aqilorn fan against the your right side, indicating that now is not the time.",
"- verb: warning",
"  notarget: You point your open aqilorn fan toward the ground, spin it once, then bring it sharply upright and snap it shut, indicating that you are issuing a warning.",
"- verb: watched",
"  notarget: You gently brush your right eyebrow with the tip of your closed aqilorn fan, indicating that you are being watched.",
"- verb: watchthis",
"  notarget: You flick your closed aqilorn fan upward, indicating that you want attention for what you're about to do.",
"- verb: who",
"  notarget: You touch your closed aqilorn fan to your left eyebrow, indicating that you want to know who.",
"- verb: 'yes'",
"  notarget: You flick your open aqilorn fan side to side, indicating that you mean yes.",
].join("\n")

# Load the YAML data
begin
  data = YAML.load(VERB_YAML_DATA)
#  puts "Loaded data:"
#  puts data.inspect  # Output the loaded data for debugging
rescue StandardError => e
  puts "Error loading YAML: #{e.message}"  # Print error if something goes wrong
end

WINDOW_ID = 'VerbWindow'
HOOK_ID   = 'verbwindow_hook'
CMD_QUEUE = Queue.new

$signature_yaml_path = File.join(DATA_DIR, XMLData.game, Char.name, "verbwindow.yaml")
$regular_yaml_path = File.join(DATA_DIR, XMLData.game, Char.name, "verb.yaml")
@show_debug = true
@show_regular_verbs = true
@show_race_verbs = true
@show_hidden_verbs = true
@show_citizenship_verbs = true
@show_premium_verbs = true
@show_fanspeak_verbs = true

@signature_verbs = {}
@regular_verbs = []
@regular_data = {}
@data = File.exist?($signature_yaml_path) ? YAML.load_file($signature_yaml_path) : { "signature_verbs" => {}, "regular_verbs" => [], "hidden_verbs" => [] }
@signature_verbs = @data["signature_verbs"] || {}

def escape_xml(text)
  text.to_s.gsub("'", '')                     # strip apostrophes completely
           .gsub('&', '&amp;')
           .gsub('<', '&lt;')
           .gsub('>', '&gt;')
           .gsub('"', '&quot;')
end

# Load the window state from the verbwindow.yaml
def load_window_state
  unless File.exist?($signature_yaml_path)
    echo "[verbwindow] No saved data found. Run ;send build to initialize."
    return :normal
  end

  data = YAML.load_file($signature_yaml_path)
  @show_regular_verbs = data.fetch("show_regular_verbs", true)
  @show_race_verbs = data.fetch("show_race_verbs", true)
		@show_citizenship_verbs = data.fetch("show_citizenship_verbs", true)
		@show_premium_verbs = data.fetch("show_premium_verbs", true)
		@show_fanspeak_verbs = data.fetch("show_fanspeak_verbs", false)
  @show_hidden_verbs = data.fetch("show_hidden_verbs", true)
  data["window_state"] || :normal
end

# Save the window state to the verbwindow.yaml
def save_window_state
  state_data = {
    "window_state" => @current_mode,
    "show_regular_verbs" => @show_regular_verbs,
    "show_race_verbs" => @show_race_verbs,
				"show_citizenship_verbs" => @show_citizenship_verbs,
				"show_premium_verbs" => @show_premium_verbs,
				"show_fanspeak_verbs" => @show_fanspeak_verbs,
	   "show_hidden_verbs" => @show_hidden_verbs,
  }
  full_data = File.exist?($signature_yaml_path) ? YAML.load_file($signature_yaml_path) : {}
  full_data.merge!(state_data)
  File.write($signature_yaml_path, full_data.to_yaml)
end

# Define sample built-in profiles.
# Each profile lists the regular verbs that should remain visible.
PROFILES = {
  "all"       => :all,
  "none"      => [],

"daena" => ["approve", "blink", "breathe", "consider", "crack", "dismiss", "exhale", "fold", "frown", "glance", "glare", "grimace", "ignore", "lean", "nod", "observe", "pace", "ponder", "pose", "redeem", "scoff", "shush", "sigh", "smirk", "snap", "sneer", "stare", "stare", "steeple", "tap", "touch", "turn", "watch"],

  # Demeanor-based profiles
  "cold" => ["glare", "scowl", "grunt", "snort", "snap", "shrug", "stare", "swear", "sneer", "scoff", "glower", "hiss", "ignore", "mutter", "crack", "growl", "wince", "grumble", "curse"],
  "reserved" => ["mumble", "blink", "fold", "ponder", "shrug", "nod", "twitch", "wait", "sigh", "observe", "listen", "inspect", "gaze", "exhale", "glance", "dismiss", "scoff", "think", "frown"],
  "neutral" => ["nod", "glance", "listen", "observe", "turn", "fold", "shrug", "pace", "watch", "breathe", "tap", "stretch", "tuck", "twiddle", "weight", "stare", "scratch", "rock", "sniff", "rest"],
  "friendly" => ["smile", "wave", "wink", "laugh", "applaud", "beam", "blush", "giggle", "salute", "hug", "pat", "preen", "chuckle", "cheer", "smooch", "nuzzle", "purr", "flutter", "grin", "pose"],
  "warm" => ["hug", "nuzzle", "cuddle", "smooch", "pat", "preen", "rub", "tickle", "touch", "snuggle", "blush", "purr", "giggle", "smile", "wave", "beam", "kiss", "gaze", "cheer", "laugh"],

  # Profession-based profiles
  "warrior" => ["arrest", "clutch", "crack", "grunt", "growl", "glare", "march", "pose", "puff", "punch", "salute", "scowl", "shout", "snap", "snarl", "snort", "stomp", "stride", "strut", "tap", "yell"],
  "rogue" => ["babble", "blink", "cackle", "cough", "cringe", "duck", "glance", "groan", "jeer", "leer", "listen", "mumble", "nod", "pace", "shrug", "smirk", "snicker", "sneer", "twitch", "whistle"],
  "monk" => ["chant", "daydream", "exhale", "fidget", "fold", "gaze", "kneel", "mumble", "ponder", "stretch", "tinker", "hum", "observe", "sigh", "breathe", "pray", "steeple", "touch", "listen", "rest"],
  "cleric" => ["beseech", "bow", "cheer", "kneel", "pray", "raise", "salute", "shush", "smile", "wave", "sigh", "hum", "fold", "observe", "flutter", "touch", "gasp", "mumble", "nod", "rest"],
  "empath" => ["blush", "cuddle", "flinch", "giggle", "hug", "kiss", "nuzzle", "pat", "pout", "snuggle", "cry", "pray", "smile", "whimper", "sigh", "grovel", "sob", "grieve", "stroke", "whine"],
  "sorcerer" => ["babble", "chant", "curse", "glare", "laugh", "mumble", "ponder", "raise", "snap", "stare", "gasp", "groan", "moan", "snarl", "sneer", "frown", "sigh", "smirk", "cackle", "puzzle"],
  "wizard" => ["chant", "exhale", "gasp", "glance", "mumble", "ponder", "raise", "tap", "think", "wave", "snap", "stretch", "hum", "tinker", "observe", "touch", "flutter", "breathe", "sigh", "smile"],
  "ranger" => ["breathe", "brush", "cough", "dust", "fly", "glance", "listen", "observe", "pace", "wait", "sigh", "smile", "wave", "watch", "nod", "gasp", "ponder", "stretch", "hug", "lean"],
  "bard" => ["beam", "bow", "cheer", "chuckle", "giggle", "hum", "laugh", "smile", "wink", "dance", "pose", "twirl", "bounce", "applaud", "sway", "wave", "salute", "flick", "prance", "smooch"],

  # Arkati-based profiles
  "charl" => ["wave", "shout", "sway", "gasp", "grunt", "glare", "jump", "wait", "pant", "watch"],
  "cholen" => ["dance", "giggle", "wink", "smile", "applaud", "flirt", "bow", "chuckle", "bounce", "laugh"],
  "eonak" => ["ponder", "observe", "dust", "tinker", "fold", "nod", "grin", "rub", "salute", "watch"],
  "imaera" => ["kneel", "smile", "breathe", "pray", "giggle", "sway", "gasp", "touch", "hug", "flutter"],
  "jastev" => ["gaze", "mumble", "cry", "stare", "daydream", "blink", "think", "pout", "sigh", "pose"],
  "kai" => ["jump", "run", "grin", "stride", "shout", "wave", "sprint", "salute", "tap", "pant"],
  "koar" => ["salute", "stand", "nod", "rest", "glare", "bow", "shout", "think", "hold", "raise"],
  "lorminstra" => ["kneel", "pray", "rest", "nod", "gasp", "whisper", "breathe", "mumble", "wait", "look"],
  "lumnis" => ["ponder", "stare", "think", "observe", "blink", "rest", "gaze", "mumble", "touch", "nod"],
  "oleani" => ["blush", "hug", "nuzzle", "smile", "kiss", "wave", "gaze", "giggle", "wink", "purr"],
  "phoen" => ["smile", "salute", "cheer", "laugh", "beam", "grin", "gaze", "wave", "stretch", "hug"],
  "ronan" => ["dream", "yawn", "sleep", "mumble", "stare", "pace", "touch", "blink", "wait", "gasp"],
  "tonis" => ["jump", "run", "move", "wave", "pace", "wink", "dart", "bow", "turn", "smile"],
  "gosaena" => ["kneel", "mumble", "pray", "stare", "drool", "gasp", "cringe", "glare", "wait", "whimper"],
  "zelia" => ["babble", "cackle", "bounce", "giggle", "shout", "grin", "snort", "pout", "daydream", "blink"],
  "andelas" => ["growl", "snarl", "pace", "pounce", "grin", "glare", "smirk", "yelp", "jeer", "stare"],
  "eorgina" => ["glare", "smirk", "snarl", "steeple", "grin", "pose", "curse", "snap", "crack", "stride"],
  "fashlonae" => ["ponder", "mumble", "stare", "glance", "gaze", "fold", "tap", "observe", "touch", "think"],
  "ivas" => ["smirk", "flirt", "giggle", "wink", "nuzzle", "kiss", "pose", "lean", "smooch", "blush"],
  "luukos" => ["hiss", "glare", "touch", "smirk", "mumble", "snarl", "pace", "wait", "gasp", "snap"],
  "marlu" => ["growl", "glare", "snap", "yell", "crack", "curse", "sneer", "shout", "scream", "stare"],
  "mularos" => ["sigh", "cry", "grovel", "mumble", "glance", "touch", "cower", "kneel", "pout", "whimper"],
  "sheru" => ["shiver", "scream", "panic", "cower", "flinch", "cringe", "stare", "twitch", "drool", "snap"],
  "vtull" => ["yell", "growl", "snap", "snarl", "shout", "stride", "grunt", "glare", "curse", "clutch"],
  "aeia" => ["smile", "gather", "kneel", "gaze", "touch", "breathe", "giggle", "daydream", "blush", "fold"],
  "amasalen" => ["snap", "glare", "snarl", "curse", "touch", "pout", "grin", "growl", "yell", "sneer"],
  "arachne" => ["smirk", "glance", "touch", "cackle", "wink", "lean", "fold", "snap", "twist", "slink"],
  "ghezresh" => ["glare", "smirk", "lean", "observe", "mumble", "pose", "point", "stare", "grin", "fold"],
  "huntress" => ["glare", "growl", "pace", "stare", "grin", "sneer", "snap", "salute", "duck", "pose"],
  "jaston" => ["gaze", "sigh", "smile", "whistle", "nod", "wait", "wave", "flutter", "jump", "rest"],
  "kuon" => ["smile", "touch", "gather", "kneel", "fold", "gaze", "sniff", "breathe", "giggle", "wave"],
  "laethe" => ["cry", "blush", "stare", "hug", "pout", "lean", "mumble", "sigh", "look", "giggle"],
  "leya" => ["salute", "grin", "glare", "punch", "bow", "stance", "growl", "nod", "wait", "fold"],
  "niima" => ["smile", "gasp", "wave", "gaze", "splash", "grin", "jump", "cheer", "sway", "swim"],
  "onar" => ["glare", "sneer", "stare", "touch", "snap", "cower", "mumble", "wait", "lean", "fold"],
  "tilamaire" => ["dance", "pose", "smile", "giggle", "bow", "grin", "twirl", "wink", "bounce", "wave"],
  "voaris" => ["blush", "sigh", "hug", "gaze", "kiss", "smile", "nuzzle", "touch", "lean", "pout"],
  "voln" => ["salute", "stand", "pray", "kneel", "rest", "fold", "observe", "bow", "nod", "wait"]

}

def save_custom_profile(profile_name)
  visible_verbs = @regular_verbs.uniq.reject { |v| VerbAPI.hidden_verbs.include?(v) }
  data = File.exist?($signature_yaml_path) ? YAML.load_file($signature_yaml_path) : {}
  custom_profiles = data["custom_profiles"] || {}
  custom_profiles[profile_name.downcase] = visible_verbs
  data["custom_profiles"] = custom_profiles
  File.write($signature_yaml_path, data.to_yaml)
  echo "[verbwindow] Custom profile '#{profile_name}' saved."
  CMD_QUEUE.push(:update)
end

def load_custom_profiles
  if File.exist?($signature_yaml_path)
    data = YAML.load_file($signature_yaml_path)
    data["custom_profiles"] || {}
  else
    {}
  end
end

def flatten_regular_verbs(raw_data)
  flat = {}
  race = {}
  citizenship = {}
  fanspeak = []
  premium = []

  raw_data.each do |key, verbs|
    next unless verbs.is_a?(Array)

    case key.downcase
    when /^[a-z]$/i
      verbs.each do |entry|
        verb = entry["verb"]
        next unless verb
        flat[verb] = entry.reject { |k, _| k == "verb" }
      end
    when "aelotoi", "burghal gnome", "dark elf", "dwarf", "elf", "erithian", "forest gnome", "giantman", "half-elf", "half-krolvin", "halfling", "human", "sylvankind"
      race[key.downcase] = verbs
    when "fanspeak"
      fanspeak = verbs
    when "premium"
      premium = verbs
    else
      citizenship[key.downcase] = verbs
    end
  end

  [flat, race, citizenship, fanspeak, premium]
end

def load_regular_verbs(force: false)
  raw_data = YAML.load(VERB_YAML_DATA)
  flat, race_data, citizenship_data, fanspeak_data, premium_data = flatten_regular_verbs(raw_data)

  full_data = File.exist?($signature_yaml_path) ? YAML.load_file($signature_yaml_path) : {}
  full_data["regular_data"] = raw_data
		full_data["regular_verbs"] = flat.keys.sort
		File.write($signature_yaml_path, full_data.to_yaml)

  @race_verb_data = race_data
  @citizenship_verb_data = citizenship_data
  @fanspeak_verbs = fanspeak_data
  @premium_verbs = premium_data

  flat
end

# Flattened data
@regular_data = load_regular_verbs
@regular_verbs = @regular_data.keys.sort

# Load the current window state (normal or reverse)
@current_mode = load_window_state

# Module to handle hiding
module VerbAPI
  @hidden_verbs_in_memory = []

  def self.hidden_verbs
    @hidden_verbs_in_memory
  end

  def self.load_from_yaml(path)
    if File.exist?(path)
      data = YAML.load_file(path)
      @hidden_verbs_in_memory = data["hidden_verbs"] || []
    else
      @hidden_verbs_in_memory = []
    end
  end

  def self.save_to_yaml(path, signature_verbs, regular_verbs)
    data = File.exist?(path) ? YAML.load_file(path) : {}
    data["signature_verbs"] = signature_verbs
    data["regular_verbs"] = regular_verbs.sort
    data["hidden_verbs"] = @hidden_verbs_in_memory
    File.write(path, data.to_yaml)
  end

  def self.toggle(verb)
    verb = verb.to_s
    if @hidden_verbs_in_memory.include?(verb)
      @hidden_verbs_in_memory.delete(verb)
#      echo "[verbwindow] Un-hid: #{verb}"
    else
      @hidden_verbs_in_memory << verb
#      echo "[verbwindow] Hid: #{verb}"
    end
    CMD_QUEUE.push(:redraw)

  end
end

unless File.exist?($signature_yaml_path)
  echo "[verbwindow] Creating new verbwindow.yaml..."
  File.write($signature_yaml_path, {
    "signature_verbs" => {},
    "regular_verbs" => [],
    "hidden_verbs" => [],
    "window_state" => :normal,
    "show_regular_verbs" => true,
    "show_race_verbs" => true,
				"show_citizenship_verbs" => true,
    "show_hidden_verbs" => true,
    "custom_profiles" => {}
  }.to_yaml)
end

# Inform player if verbwindow.yaml doesn't exist
if @signature_verbs.empty?
  echo "[verbwindow] No signature verbs found. Run ;send build to initialize."
else
  echo "[verbwindow] Loaded #{@signature_verbs.size} signature verbs."
end

VerbAPI.load_from_yaml($signature_yaml_path)

# Load the current window state (normal or reverse)
@current_mode = load_window_state  # Load saved mode state (normal or reverse)

def fan_check
  GameObj.containers.each do |container|
    fans = GameObj[container[0]].contents.select { |item| item.noun =~ /fan$/i }
    return [container[0], fans] unless fans.empty?
  end
  nil
end

def perform_fanspeak_verb(verb)
  # If either hand has a fan, just do the fanspeak
  if GameObj.right_hand&.noun =~ /fan$/i || GameObj.left_hand&.noun =~ /fan$/i
    return %Q[;e fput("fanspeak #{verb}")]
  end

  # Otherwise, try to find and get a fan
  if fan_object = fan_check
    fan_container_id = fan_object[0]
    fan = fan_object[1].first
    if fan
      return %Q[;e fput("get ##{fan.id}");; fput("fanspeak #{verb}")]
    end
  end

  # Final fallback
  return %Q[;e echo "No fan found to perform #{verb}."]
end

# Render NORMAL window
def render_signature_window
  hidden = VerbAPI.hidden_verbs
  output = "<dialogData id='#{WINDOW_ID}' clear='t'>"

  top = 0
  # Header information.
  output += "<label id='header1' value='Click on verb for preview.' justify='left' left='0' top='#{top}' />"
  top += 20
  output += "<label id='header2' value='Click on ( ! ) to activate.' justify='left' left='0' top='#{top}' />"
  top += 20
  output += "<label id='header3' value='Click on [ X ] to hide.' justify='left' left='0' top='#{top}' />"
  top += 20

  output += "<label id='sig_header' value='Signature Verbs:' justify='left' left='0' top='#{top}' />"
  top += 20

  visible_signature = @signature_verbs.sort_by(&:first).reject { |(verb, _)| hidden.include?(verb) }
  hidden_signature  = @signature_verbs.sort_by(&:first).select { |(verb, _)| hidden.include?(verb) }

  visible_signature.each_with_index do |(verb, info), i|
    if info["target"] == "none"
      output += "<link id='sig_exec_#{i}' value='( ! )' cmd='signature #{verb}' echo='signature #{verb}' justify='left' left='0' top='#{top}' />"
    end
    output += "<link id='sig_#{i}' value='#{escape_xml(info["label"])}' cmd='signature view #{escape_xml(verb)}' echo='signature view #{escape_xml(verb)}' justify='left' left='30' top='#{top}' />"
output += "<link id='sig_hide_#{i}' value='[ X ]' cmd=';eq VerbAPI.toggle(:#{escape_xml(verb)})' echo='[Hiding #{escape_xml(verb)}]' justify='left' left='140' top='#{top}' />"

    top += 20
  end

  unless hidden_signature.empty?
    output += "<label id='hidden_sig_header' value='Hidden Signature Verbs:' justify='left' left='0' top='#{top}' />"
    top += 20
    hidden_signature.each_with_index do |(verb, info), i|
      output += "<link id='hidden_sig_#{i}' value='( HIDDEN ) #{info["label"]}' cmd=';eq VerbAPI.toggle(:#{verb})' echo='[Unhiding #{verb}]' justify='left' left='30' top='#{top}' />"
      top += 20
    end
  end
  
if @show_race_verbs && !@race_verb_data.empty?
  race_key = Char.race.downcase.strip
  if @race_verb_data.key?(race_key)

    # Group race verbs by base verb
    grouped_race_verbs = @race_verb_data[race_key].group_by do |entry|
      entry["verb"].split.first
    end

    output += "<label id='race_verb_header' value='Race Verbs:' justify='left' left='0' top='#{top}' />"
    top += 20

    race_counter = 0  # Ensures unique link IDs

    grouped_race_verbs.sort.each do |base, entries|
      output += "<label id='race_group_#{base}' value='  #{race_key.capitalize} #{base.capitalize}' justify='left' left='0' top='#{top}' />"
      top += 20

entries.each do |entry|
  verb = entry["verb"]
  next if VerbAPI.hidden_verbs.include?(verb)

  notarget = entry["notarget"]
  selfdesc = entry["self"]
  targetdesc = entry["target"]
  cmds = []
  desc = []
  desc << "\nNoTarget: #{notarget}\n" if notarget
  desc << "Self    : #{selfdesc}\n" if selfdesc
  desc << "Target  : #{targetdesc}\n" if targetdesc
  cmd = ";e echo #{desc.join('').inspect}"
  
  suffix = verb.sub(/^#{Regexp.escape(base)}\s*/, '')
  label = suffix.strip.empty? ? base.capitalize : suffix.strip
  label = "[MISSING]" if label.nil? || label.empty?

  output += "<link id='race_exec_#{race_counter}' value='( ! )' cmd='#{escape_xml(verb)}' echo='#{escape_xml(verb)}' justify='left' left='0' top='#{top}' />" if notarget
  output += "<link id='race_self_#{race_counter}' value='(S)' cmd='#{escape_xml("#{verb} #{Char.name}")}' echo='#{escape_xml("#{verb} #{Char.name}")}' justify='left' left='25' top='#{top}' />" if selfdesc
  output += "<link id='race_verb_#{race_counter}' value='#{escape_xml(label)}' cmd='#{escape_xml(cmd)}' echo='[Previewing #{escape_xml(verb)}]' justify='left' left='50' top='#{top}' />"
  output += "<link id='race_hide_#{race_counter}' value='[ X ]' cmd=';eq VerbAPI.toggle(\"#{escape_xml(verb)}\")' echo='[Hiding #{escape_xml(verb)}]' justify='left' left='140' top='#{top}' />"

  top += 20
  race_counter += 1
end

    end
  end
end

if @show_citizenship_verbs && !@citizenship_verb_data.empty?
  citizen_key = Char.citizenship.to_s.downcase.strip
  if @citizenship_verb_data.key?(citizen_key)

    # Group citizenship verbs by base verb
    grouped_citizen_verbs = @citizenship_verb_data[citizen_key].group_by do |entry|
      entry["verb"].split.first
    end

    output += "<label id='citizen_verb_header' value='Citizenship Verbs:' justify='left' left='0' top='#{top}' />"
    top += 20

    output += "<label id='citizen_group_location' value='  #{citizen_key.capitalize}' justify='left' left='0' top='#{top}' />"
    top += 20

    citizen_counter = 0  # Ensures unique link IDs

    grouped_citizen_verbs.sort.each do |base, entries|

      entries.each do |entry|
        verb = entry["verb"]
        next if VerbAPI.hidden_verbs.include?(verb)

        notarget = entry["notarget"]
        selfdesc = entry["self"]
        targetdesc = entry["target"]
        desc = []
        desc << "\nNoTarget: #{notarget}\n" if notarget
        desc << "Self    : #{selfdesc}\n" if selfdesc
        desc << "Target  : #{targetdesc}\n" if targetdesc
        cmd = ";e echo #{desc.join('').inspect}"

        label = base.capitalize

        output += "<link id='citizen_exec_#{citizen_counter}' value='( ! )' cmd='#{escape_xml(verb)}' echo='#{escape_xml(verb)}' justify='left' left='0' top='#{top}' />" if notarget
        output += "<link id='citizen_self_#{citizen_counter}' value='(S)' cmd='#{escape_xml("#{verb} #{Char.name}")}' echo='#{escape_xml("#{verb} #{Char.name}")}' justify='left' left='25' top='#{top}' />" if selfdesc
        output += "<link id='citizen_verb_#{citizen_counter}' value='#{escape_xml(label)}' cmd='#{escape_xml(cmd)}' echo='[Previewing #{escape_xml(verb)}]' justify='left' left='50' top='#{top}' />"
        output += "<link id='citizen_hide_#{citizen_counter}' value='[ X ]' cmd=';eq VerbAPI.toggle(\"#{escape_xml(verb)}\")' echo='[Hiding #{escape_xml(verb)}]' justify='left' left='140' top='#{top}' />"

        top += 20
        citizen_counter += 1
      end
    end
  end
end

if @show_premium_verbs && @premium_verbs.any?
  # Group premium verbs by base verb
  grouped_premium_verbs = @premium_verbs.group_by do |entry|
    entry["verb"].split.first
  end

  output += "<label id='premium_verb_header' value='Premium Verbs:' justify='left' left='0' top='#{top}' />"
  top += 20

  premium_counter = 0  # Ensures unique link IDs

  grouped_premium_verbs.sort.each do |base, entries|
    output += "<label id='premium_group_#{base}' value='  #{base.capitalize}' justify='left' left='0' top='#{top}' />"
    top += 20

    entries.each do |entry|
      verb = entry["verb"]
      next if VerbAPI.hidden_verbs.include?(verb)

      notarget = entry["notarget"]
      selfdesc = entry["self"]
      targetdesc = entry["target"]

      desc = []
      desc << "\nNoTarget: #{notarget}\n" if notarget
      desc << "Self    : #{selfdesc}\n" if selfdesc
      desc << "Target  : #{targetdesc}\n" if targetdesc
      cmd = ";e echo #{desc.join('').inspect}"

      suffix = verb.sub(/^#{Regexp.escape(base)}\s*/, '')
      label = suffix.strip.empty? ? base.capitalize : suffix.strip
      label = "[MISSING]" if label.nil? || label.empty?

      output += "<link id='premium_exec_#{premium_counter}' value='( ! )' cmd='#{escape_xml(verb)}' echo='#{escape_xml(verb)}' justify='left' left='0' top='#{top}' />" if notarget
      output += "<link id='premium_self_#{premium_counter}' value='(S)' cmd='#{escape_xml("#{verb} #{Char.name}")}' echo='#{escape_xml("#{verb} #{Char.name}")}' justify='left' left='25' top='#{top}' />" if selfdesc
      output += "<link id='premium_verb_#{premium_counter}' value='#{escape_xml(label)}' cmd='#{escape_xml(cmd)}' echo='[Previewing express #{escape_xml(verb)}]' justify='left' left='50' top='#{top}' />"
      output += "<link id='premium_hide_#{premium_counter}' value='[ X ]' cmd=';eq VerbAPI.toggle(\"#{escape_xml(verb)}\")' echo='[Hiding #{escape_xml(verb)}]' justify='left' left='140' top='#{top}' />"

      top += 20
      premium_counter += 1
    end
  end
end

if @show_fanspeak_verbs && @fanspeak_verbs && !@fanspeak_verbs.empty?
  output += "<label id='fanspeak_header' value='Fanspeak Verbs:' justify='left' left='0' top='#{top}' />"
  top += 20

  @fanspeak_verbs.each_with_index do |entry, i|
    verb = entry["verb"]
    next if hidden.include?(verb)

    notarget   = entry["notarget"]
    selfdesc   = entry["self"]
    targetdesc = entry["target"]
    desc = []
    desc << "\nNoTarget: #{notarget}\n" if notarget
    desc << "Self    : #{selfdesc}\n" if selfdesc
    desc << "Target  : #{targetdesc}\n" if targetdesc

    execute_cmd = perform_fanspeak_verb(verb)
    preview_cmd = ";e echo #{desc.join('').inspect}"

    output += "<link id='fanspeak_exec_#{i}' value='( ! )' cmd='#{escape_xml(execute_cmd)}' echo='#{escape_xml(verb)}' justify='left' left='0' top='#{top}' />" if notarget
    output += "<link id='fanspeak_verb_#{i}' value='#{escape_xml(verb.capitalize)}' cmd='#{escape_xml(preview_cmd)}' echo='[Previewing #{escape_xml(verb)}]' justify='left' left='50' top='#{top}' />"
    output += "<link id='fanspeak_hide_#{i}' value='[ X ]' cmd=';eq VerbAPI.toggle(\"#{escape_xml(verb)}\")' echo='[Hiding #{escape_xml(verb)}]' justify='left' left='140' top='#{top}' />"
    top += 20
  end
end

if @show_regular_verbs
  output += "<label id='reg_header' value='Regular Verbs:' justify='left' left='0' top='#{top}' />"
  top += 20

  visible_regular = @regular_verbs.reject { |v| hidden.include?(v) }

  visible_regular.each_with_index do |verb, i|
    data = @regular_data[verb]
notarget = data["notarget"]
selfdesc = data["self"]
targetdesc = data["target"]
cmds = []
desc = []
desc << "\nNoTarget: #{notarget}\n" if notarget
desc << "Self    : #{selfdesc}\n" if selfdesc
desc << "Target    : #{targetdesc}\n" if targetdesc
cmd = ";e echo #{desc.join('').inspect}"

output += "<link id='reg_exec_#{i}' value='( ! )' cmd='#{escape_xml(verb)}' echo='#{escape_xml(verb)}' justify='left' left='0' top='#{top}' />" if notarget
output += "<link id='reg_self_#{i}' value='(S)' cmd='#{escape_xml("#{verb} #{Char.name}")}' echo='#{escape_xml("#{verb} #{Char.name}")}' justify='left' left='25' top='#{top}' />" if selfdesc
    label = verb.dup
label += " (T)" if data["target"]
output += "<link id='reg_verb_#{i}' value='#{escape_xml(label)}' cmd='#{escape_xml(cmd)}' echo='[Previewing #{escape_xml(verb)}]' justify='left' left='50' top='#{top}' />"
output += "<link id='reg_hide_#{i}' value='[ X ]' cmd=';eq VerbAPI.toggle(:#{escape_xml(verb)})' echo='[Hiding #{escape_xml(verb)}]' justify='left' left='140' top='#{top}' />"
    top += 20
  end
end

  hidden_regular = @regular_verbs.select { |v| hidden.include?(v) }
  hidden_signature = @signature_verbs.keys.select { |v| hidden.include?(v) }
		hidden_premium = @premium_verbs.select { |entry| hidden.include?(entry[:type]) }

  hidden_race = []
  if @race_verb_data && @race_verb_data[race_key]
    hidden_race = @race_verb_data[race_key].select { |entry| hidden.include?(entry["verb"]) }
  end

  if @show_hidden_verbs && (!hidden_regular.empty? || !hidden_signature.empty? || !hidden_race.empty?)
    output += "<label id='hidden_all_header' value='Hidden Verbs:' justify='left' left='0' top='#{top}' />"
    top += 20

    hidden_signature.each_with_index do |verb, i|
      label = @signature_verbs[verb]["label"]
      output += "<link id='hidden_sig_#{i}' value='( HIDDEN ) #{escape_xml(label)}' cmd=';eq VerbAPI.toggle(\"#{escape_xml(verb)}\")' echo='[Unhiding #{escape_xml(verb)}]' justify='left' left='30' top='#{top}' />"
      top += 20
    end

    hidden_regular.each_with_index do |verb, i|
      output += "<link id='hidden_reg_#{i}' value='( HIDDEN ) #{escape_xml(verb)}' cmd=';eq VerbAPI.toggle(\"#{escape_xml(verb)}\")' echo='[Unhiding #{escape_xml(verb)}]' justify='left' left='30' top='#{top}' />"
      top += 20
    end

    hidden_race.each_with_index do |entry, i|
      verb = entry["verb"]
      label = verb.sub(/^#{Regexp.escape(verb.split.first)}\s*/, '').strip
      label = label.empty? ? verb.split.first : label
      label = "#{Char.race.capitalize} #{label.capitalize}"
      output += "<link id='hidden_race_#{i}' value='( HIDDEN ) #{escape_xml(label)}' cmd=';eq VerbAPI.toggle(\"#{escape_xml(verb)}\")' echo='[Unhiding #{escape_xml(verb)}]' justify='left' left='30' top='#{top}' />"
      top += 20
    end
  end
		
				hidden_premium.each_with_index do |entry, i|
						verb = entry[:type]
						output += "<link id='hidden_premium_#{i}' value='( HIDDEN ) #{escape_xml(verb)}' cmd=';eq VerbAPI.toggle(\"#{escape_xml(verb)}\")' echo='[Unhiding #{escape_xml(verb)}]' justify='left' left='30' top='#{top}' />"
						top += 20
				end

  output += "</dialogData>"
  puts("<closeDialog id='#{WINDOW_ID}'/><openDialog type='dynamic' id='#{WINDOW_ID}' title='Verbs' scroll='auto' location='main' justify='3' height='500' resident='true'>#{output}</openDialog>")
  
end


# Render REVERSE window
def render_reverse_window
  hidden = VerbAPI.hidden_verbs
  output = "<dialogData id='#{WINDOW_ID}' clear='t'>"

  top = 0
  # Header information.
  output += "<label id='header1' value='Click on verb to activate.' justify='left' left='0' top='#{top}' />"
  top += 20
  output += "<label id='header3' value='Click on [ X ] to hide.' justify='left' left='0' top='#{top}' />"
  top += 20

# Build a sorted array of [description_text, verb, command]
entries = []

# Include regular verbs
@regular_verbs.reject { |v| hidden.include?(v) }.each do |verb|
  data = @regular_data[verb]
  entries << [data["notarget"].strip, verb, verb] if data["notarget"]
  entries << [data["self"].strip, verb, "#{verb} #{Char.name}"] if data["self"]
  entries << [data["target"].strip, verb, "#{verb} TARGET"] if data["target"]
end

# Include race verbs
race_key = Char.race.downcase.strip
if @race_verb_data.key?(race_key)
  @race_verb_data[race_key].each do |entry|
    verb = entry["verb"]
    next if hidden.include?(verb)

    notarget = entry["notarget"]
    selfdesc = entry["self"]
    targetdesc = entry["target"]

    entries << [notarget.strip, verb, verb] if notarget
    entries << [selfdesc.strip, verb, "#{verb} #{Char.name}"] if selfdesc
    entries << [targetdesc.strip, verb, "#{verb} TARGET"] if targetdesc
  end
end

# Include fanspeak verbs
#if @fanspeak_verbs
#  @fanspeak_verbs.each do |entry|
#    verb = entry["verb"]
#    next if hidden.include?(verb)

#    notarget   = entry["notarget"]
#    selfdesc   = entry["self"]
#    targetdesc = entry["target"]

#    entries << [notarget.strip, verb, "perform_fanspeak_verb('#{verb}')"] if notarget
#    entries << [selfdesc.strip, verb, "perform_fanspeak_verb('#{verb}')"] if selfdesc
#    entries << [targetdesc.strip, verb, "perform_fanspeak_verb('#{verb}')"] if targetdesc
#  end
#end

# Include signature verbs
#@signature_verbs.each do |verb, info|
#  next if hidden.include?(verb)
#
#  label = info["label"]
#  target_type = info["target"]
#  cmd = "signature #{verb}"
#  entries << [label.strip, verb, cmd]
#end

# Sort all descriptions alphabetically by the description text
entries.sort_by! { |desc, _, _| desc.downcase }

# Render the sorted entries into clickable links
entries.each_with_index do |(desc, verb, cmd), i|

  output += "<link id='rev_hide_#{i}' value='[ X ]' cmd=';eq VerbAPI.toggle(:#{verb})' echo='[Hiding #{verb}]' justify='left' left='0' top='#{top}' />"
  label = "#{desc} [#{cmd.include?(' ') ? "#{verb} self" : verb}]"
  output += "<link id='rev_desc_#{i}' value='#{escape_xml(label)}' cmd='#{cmd}' echo='#{cmd}' justify='left' left='30' top='#{top}' />"
  top += 20
end

  hidden_regular = @regular_verbs.select { |v| hidden.include?(v) }
  if @show_hidden_verbs && !hidden_regular.empty?
    output += "<label id='hidden_rev_header' value='Hidden Verbs:' justify='left' left='0' top='#{top}' />"
    top += 20
    hidden_regular.each_with_index do |verb, i|
      output += "<link id='hidden_rev_#{i}' value='( HIDDEN ) #{verb}' cmd=';eq VerbAPI.toggle(:#{verb})' echo='[Unhiding #{verb}]' justify='left' left='30' top='#{top}' />"
      top += 20
    end
  end

  output += "</dialogData>"
  puts("<closeDialog id='#{WINDOW_ID}'/><openDialog type='dynamic' id='#{WINDOW_ID}' title='Verbs (Reverse Mode)' scroll='auto' location='main' justify='3' height='500' resident='true'>#{output}</openDialog>")
end

before_dying do
  VerbAPI.save_to_yaml($signature_yaml_path, @signature_verbs, @regular_verbs)
  DownstreamHook.remove(HOOK_ID)
end

# Load signature verbs if not already loaded
@signature_parse_buffer ||= {}

DownstreamHook.add(HOOK_ID, proc { |line|
  # Capture signature verb data
  if line =~ /<d cmd="signature view ([^"]+)">([^<]+)<\/d>\s+(player|none)/i
    verb = $1.strip
    label = $2.strip
    target_type = $3.strip.downcase
    label += " (T)" if target_type == "player"

    if verb =~ /^[a-z0-9_-]+$/i && !@signature_verbs.key?(verb) && !@signature_parse_buffer.key?(verb)
      @signature_parse_buffer[verb] = {
        "label" => label,
        "description" => nil,
        "target" => target_type
      }
    end
  end

  line
})

Thread.new do
  loop do
    line = get.strip
    case line
    when /^refresh$/i
      CMD_QUEUE.push(:update)

    when /^build$/i
						echo "[verbwindow] Parsing signature verbs..."

						# Trigger the signature list so downstream hook can populate the buffer
						dothistimeout("signature", 3, /Valid Options for this character:/)
						sleep 0.3  # allow downstream hook to populate @signature_parse_buffer

						@signature_verbs.merge!(@signature_parse_buffer)
						@signature_parse_buffer.clear
						VerbAPI.save_to_yaml($signature_yaml_path, @signature_verbs, @regular_verbs)
						echo "[verbwindow] Parsed #{@signature_verbs.size} signature verbs."

						CMD_QUEUE.push(:update)

    when /^reverse$/i
      CMD_QUEUE.push(:reverse)

    when /^normal$/i
      CMD_QUEUE.push(:update)

    when /^save\s+(\w+)/i
      profile_name = $1.downcase
      data = File.exist?($signature_yaml_path) ? YAML.load_file($signature_yaml_path) : {}
      custom_profiles = data["custom_profiles"] || {}
      custom_profiles[profile_name] = @regular_verbs.uniq.reject { |v| VerbAPI.hidden_verbs.include?(v) }
      data["custom_profiles"] = custom_profiles
      File.write($signature_yaml_path, data.to_yaml)
      echo "[verbwindow] Custom profile '#{profile_name}' saved."

    when /^load\s+(\w+)/i
      profile_name = $1.downcase
      data = File.exist?($signature_yaml_path) ? YAML.load_file($signature_yaml_path) : {}
      profiles = data["custom_profiles"] || {}

      if PROFILES.key?(profile_name)
        if PROFILES[profile_name] == :all
          VerbAPI.instance_variable_set(:@hidden_verbs_in_memory, [])
        else
          profile_verbs = PROFILES[profile_name]
          new_hidden = @regular_verbs.uniq.reject { |v| profile_verbs.include?(v) || @signature_verbs.key?(v) }
          VerbAPI.instance_variable_set(:@hidden_verbs_in_memory, new_hidden)
        end
        VerbAPI.save_to_yaml($signature_yaml_path, @signature_verbs, @regular_verbs)
        echo "[verbwindow] Built-in profile '#{profile_name}' loaded."
        CMD_QUEUE.push(:update)
        next
      end

      if profiles[profile_name]
        visible = profiles[profile_name]
        new_hidden = @regular_verbs.uniq.reject { |v| visible.include?(v) || @signature_verbs.key?(v) }
        VerbAPI.instance_variable_set(:@hidden_verbs_in_memory, new_hidden)
        VerbAPI.save_to_yaml($signature_yaml_path, @signature_verbs, @regular_verbs)
        echo "[verbwindow] Profile '#{profile_name}' loaded."
        CMD_QUEUE.push(:update)
      else
        echo "[verbwindow] Unknown profile '#{profile_name}'"
      end

    when /^regular$/i
      @show_regular_verbs = !@show_regular_verbs
      save_window_state
      echo "[verbwindow] Regular verbs #{@show_regular_verbs ? 'enabled' : 'disabled'}."
      CMD_QUEUE.push(:update)

    when /^race$/i
      @show_race_verbs = !@show_race_verbs
      save_window_state
      echo "[verbwindow] Race verbs #{@show_race_verbs ? 'enabled' : 'disabled'}."
      CMD_QUEUE.push(:update)

    when /^citizenship$/i
      @show_citizenship_verbs = !@show_citizenship_verbs
      save_window_state
      echo "[verbwindow] Citizenship verbs #{@show_citizenship_verbs ? 'enabled' : 'disabled'}."
      CMD_QUEUE.push(:update)
	
    when /^premium$/i
      @show_premium_verbs = !@show_premium_verbs
      save_window_state
      echo "[verbwindow] Premium verbs #{@show_premium_verbs ? 'enabled' : 'disabled'}."
      CMD_QUEUE.push(:update)
	
    when /^fanspeak$/i
      @show_fanspeak_verbs = !@show_fanspeak_verbs
      save_window_state
      echo "[verbwindow] Fanspeak verbs #{@show_fanspeak_verbs ? 'enabled' : 'disabled'}."
      CMD_QUEUE.push(:update)
						
    when /^hidden$/i
      @show_hidden_verbs = !@show_hidden_verbs
      save_window_state
      echo "[verbwindow] Hidden verbs #{@show_hidden_verbs ? 'enabled' : 'disabled'}."
      CMD_QUEUE.push(:update)

    when /^delete\s+(\w+)/i
      profile_name = $1.downcase
      data = File.exist?($signature_yaml_path) ? YAML.load_file($signature_yaml_path) : {}
      custom_profiles = data["custom_profiles"] || {}

      if custom_profiles.delete(profile_name)
        data["custom_profiles"] = custom_profiles
        File.write($signature_yaml_path, data.to_yaml)
        echo "[verbwindow] Profile '#{profile_name}' deleted."
      else
        echo "[verbwindow] No profile named '#{profile_name}' found."
      end

    when /^help\b/i
      help_text = <<-HELP
[verbwindow] Available commands:
  ;send build                => Rebuild the verb list and populate the YAML.
  ;send regular              => Enable/disable regular verbs in the window.
  ;send race                 => Enable/disable race verbs in the window.
  ;send citizenship          => Enable/disable citizenship verbs in the window.
		;send premium              => Enable/disable premium verbs in the window.
		;send fanspeak             => Enable/disable fanspeak verbs in the window.
  ;send load [profile_name]  => Load a profile (custom, demeanor, profession, or Arkati).
    Demeanor profiles:      cold, reserved, neutral, friendly, warm, clear
    Profession profiles:    warrior, rogue, monk, cleric, empath, sorcerer, wizard, ranger, bard
    Arkati profiles:        charl, cholen, eonak, imaera, jastev, kai, koar, lorminstra, lumnis, oleani,
                            phoen, ronan, tonis, gosaena, zelia, andelas, eorgina, fashlonae, ivas,
                            luukos, marlu, mularos, sheru, vtull, aeia, amasalen, arachne, ghezresh,
                            huntress, jaston, kuon, laethe, leya, niima, onar, tilamaire, voaris, voln
  ;send save [profile_name]  => Save current visible regular verbs as a custom profile.
  ;send delete [profile_name]=> Delete a saved custom profile.
  ;send refresh              => Refresh the window.
  ;send help                 => Display this help message.
      HELP
      echo(help_text)
    end

    sleep 0.1
  end
end

@show_debug = true
CMD_QUEUE.push(@current_mode == :reverse ? :reverse : :update)

loop do
  if !@skip_signature_merge && @signature_parse_buffer && !@signature_parse_buffer.empty?
    @signature_verbs.merge!(@signature_parse_buffer)
    VerbAPI.save_to_yaml($signature_yaml_path, @signature_verbs, @regular_verbs)
    @signature_parse_buffer.clear
    CMD_QUEUE.push(:update)
  end
  @skip_signature_merge = false

  action = CMD_QUEUE.pop
  case action
  
		when :update
				@current_mode = :normal
				save_window_state

				if @show_debug
						total_sig = @signature_verbs.size
						total_reg = @regular_verbs.size
						total_hidden = VerbAPI.hidden_verbs.size

						total_race = 0
						total_citizen = 0
						
						echo "[verbwindow] Signature verbs: #{total_sig}"

						if @race_verb_data && @show_race_verbs
								race_key = Char.race.downcase.strip
								if @race_verb_data[race_key]
										visible_race = @race_verb_data[race_key].reject { |entry| VerbAPI.hidden_verbs.include?(entry["verb"]) }
										total_race = visible_race.size
										echo "[verbwindow] Race: #{race_key.capitalize} (#{total_race} verbs)"
								end
						end

						if @citizenship_verb_data && @show_citizenship_verbs && Char.respond_to?(:citizenship)
								citizen_key = Char.citizenship.to_s.downcase.strip
								if @citizenship_verb_data[citizen_key]
										visible_citizen = @citizenship_verb_data[citizen_key].reject { |entry| VerbAPI.hidden_verbs.include?(entry["verb"]) }
										total_citizen = visible_citizen.size
										echo "[verbwindow] Citizenship: #{citizen_key.capitalize} (#{total_citizen} verbs)"
								end
						end

      total_premium = 0
						if @show_premium_verbs && @premium_verbs
								visible_premium = @premium_verbs.reject { |entry| VerbAPI.hidden_verbs.include?(entry[:type]) }
								total_premium = visible_premium.size
								echo "[verbwindow] Premium verbs: #{total_premium}"
						end
					
						total_fanspeak = 0
						if @show_fanspeak_verbs && @fanspeak_verbs
								total_fanspeak = @fanspeak_verbs.reject { |entry| VerbAPI.hidden_verbs.include?(entry["verb"]) }.size
								echo "[verbwindow] Fanspeak verbs: #{total_fanspeak}"
						end

      total_visible = (total_sig + total_reg + total_race + total_citizen + total_fanspeak) - total_hidden
						echo "[verbwindow] Regular verbs: #{total_reg}"
						echo "[verbwindow] Hidden verbs: #{total_hidden}"
						echo "[verbwindow] Total visible verbs: #{total_visible}"

				end

  render_signature_window
  @show_debug = false

  when :reverse
    @current_mode = :reverse
    save_window_state
    render_reverse_window
    @show_debug = false

  when :redraw
    @show_debug = false
    @current_mode == :reverse ? render_reverse_window : render_signature_window
  end
end