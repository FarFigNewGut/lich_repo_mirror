=begin
    autostand.lic

    Automatically stands and goes stance defensive if you get knocked down in the presence
	of aggressive NPCs.
	
	Will also help you stand if you slip on the Icemule Trail.

          author: Sulien
            game: Gemstone
            tags: hunting utility
         version: 0.0.1
=end


IGNORE_ROOMS = [9828, 14660, 14661, 14662]

def dangerous_creatures?
	GameObj.npcs.any? {|s| s.type =~ /aggressive npc/}
end

def icy_room?
	Room.current.title[0] =~ /\[(Glatoph|Snowy Plains|Blue Glacier|Icemule Trail)/
end

def ignore_current_room?
	 IGNORE_ROOMS.member?(Room.current.id) || (!icy_room? && !dangerous_creatures?)
end


loop do
	while checkstanding || checkdead || checkhiding || ignore_current_room?
		clear
		sleep 0.75
		_throwaway = get
	end

	wait_while { stunned? || (checkrt > 0) }

	(0..15).each do |n|
		echo "Unable to stand!" if n == 14
		
		if not checkstanding
			put "stand"
			sleep 0.3
		end

		if checkstanding || checkdead
			break
		else
			sleep 0.5
		end
	end

	waitrt?

	fput "stance def" if not checkdead and not checkstance("defensive")

	sleep 1
end  