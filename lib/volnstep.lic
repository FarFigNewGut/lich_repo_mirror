=begin
Completes the Voln stepping tasks for you. If you've never completed the Voln steps on your own, you really should consider doing them for yourself the first time. There are many interesting things to learn along the way.

Some steps flow easily with no user input needed; others need a little input from the user.

Command is ;volnstep task

Also, will check favor to next step if you type ;volnstep check.

Send bug information to GS4Lass@gmail.com. This is a tricky script to debug because once you've done a step, you're done and you can't readily duplicate errors.

author: Jennora
contributors: Xanlin, Kamkor
game: GS
tags: voln
version: 2.1 BETA

Special thanks to my dear friend, Kamkor, for helping me debug.

UPDATE: 
		12/27/2022 Fixed errors with Landing step 24. I shouldn't have trusted the process.
		11/23/2022 Completed error correction of Landing step 24. Trust the process.
		11/22/2022 Began error correction for Landing step 24. It's closer but not perfected.
		11/21/2022 Corrected error with Landing Imaera step 6.
		11/2022 Actively updating lich room numbers to uid numbers; will update when completed.
		10/2022 Completed Ta'Vaalor steps.
		9/2022 Updated for Ta'Vaalor through Step 19.
		4/8/2019 Updated for Ta'Vaalor through step 16. Please send an email to gs4lass@gmail.com with any questions, issues, or comments.
		10/12/2013 Corrected an errant room number.
		10/8/2013 Added "a bouquet of Bridal Blush roses" as an option for Step 16. Updated the museum rooftop room number.
=end

voln_monk = Hash.new()
voln_monk[0]  = [18212, 14116007] #Tonis
voln_monk[1]  = [18211, 14116008] #Eonak
voln_monk[2]  = [18210, 14116009] #Oleani
voln_monk[3]  = [18209, 14116010] #Cholen
voln_monk[4]  = [18208, 14116011] #Jastev
voln_monk[5]  = [18207, 14116012] #Imaera
voln_monk[6]  = [18206, 14116013] #Charl
voln_monk[7]  = [18205, 14116014] #Kai
voln_monk[8]  = [18204, 14116015] #Phoen
voln_monk[9]  = [18203, 14116016] #Lorminstra
voln_monk[10] = [18202, 14116017] #Ronan
voln_monk[11] = [18201, 14116018] #Lumnis
voln_monk[12] = [18200, 14116019] #Koar
voln_monk[13] = [18199, 14116020] #Tonis
voln_monk[14] = [18198, 14116021] #Eonak
voln_monk[15] = [18197, 14116022] #Oleani
voln_monk[16] = [18196, 14116023] #Cholen
voln_monk[17] = [18195, 14116024] #Jastev
voln_monk[18] = [18194, 14116025] #Imaera
voln_monk[19] = [18193, 14116026] #Charl
voln_monk[20] = [18192, 14116027] #Kai
voln_monk[21] = [18191, 14116028] #Phoen
voln_monk[22] = [18190, 14116029] #Lorminstra
voln_monk[23] = [18188, 14116030] #Ronan
voln_monk[24] = [18189, 14116031] #Lumnis
voln_monk[25] = [22004, 25946] #Koar

#Define special procedures
#UID
def self.uids_to_ids(arr)
  if arr.class == Integer
    arr = [arr]
  elsif arr.class == String
    arr = [arr.sub('u','').to_i]
  end
  return arr.each_with_object([]){ |uid,ids| 
    uid = uid.sub('u','').to_i if uid.class == String;
    ids << Map.uids[uid].first
  }
end

#Water tunnel ride
gowater = Proc.new do
	fput "go opening"
	fput "go stream"
	fput "lie"
	waitfor "you race"
	fput "lean left"
	waitfor "Suddenly the tunnel turns into a nearly vertical drop"
	fput "lean left"
	waitfor "just ahead the tunnel splits left and right"
	fput "lean left"
	waitfor "You are on the bank of a beautiful mountain lake that is fed by a waterfall gushing from the mountain sid"
end

imaerashrine = Proc.new do
	Script.run('go2', 'u93080')
	fput "kneel"
	fput "bury acorn"
	waitfor "overwhelmed by a sudden tingling sensation"
	echo
	echo "Another job well done..."
	echo 
	pause 3
	Script.run('go2', 'u312006')
	exit
end

charlshrine = Proc.new do
	Script.run('go2', 'u386022')
	fput "drop coral"
	start_script 'go2', ['u312007']
	wait_while {running? 'go2'}
	exit
end

charlshrine2 = Proc.new do
	Script.run('go2', 'u14001002')
	fput "put coral"
	waitfor "overwhelmed by a sudden tingling sensation"
	Script.run('go2', 'u14116013')
	exit
end

step17 = Proc.new do
	echo "All right, we'll see if we can get this done. When all are here, type ;u to unpause the script! Make sure your friends laugh a LOT. That, to me, seems to be the key."
	pause_script
	fput "act prances around like a monkey, but drops to the floor and pretends to be a frog, Riiibitting loudly!"
	sleep 3
	fput "laugh"
	sleep 6
	fput "act suddenly springs from the floor and begins to dance around the room, doing spin after spin, until tumbling to the floor in a dizzy heap."
	sleep 3
	fput "laugh"
	sleep 8
	fput "act clambers up like a clown, gripping onto the drainpipe for support. The ladder shifts, and the clumsy clown falls to the floor again."
	sleep 2
	fput "roll laugh"
	sleep 5
	fput "act rolls around on the floor in a vain attempt to stand, and ends up looking like a bug stuck on its back, arms and legs flailing." 
	sleep 3
	fput "laugh"
	sleep 7
	fput "act sits upright and stretches. Grinning stupidly before leaning to the left. A quick stretch of the right leg proves to be a mistake, causing a another flop to the floor."
	sleep 1
	fput "laugh"
	sleep 5
	fput "act grins widely, but finally manages to stand; not before, however, slipping and falling several times on the rooftop's flat surface."
	sleep 2
	fput "laugh"
	sleep 8
	fput "act continues with the pratfalls and mania, and begins to roll about, oinking and rutting like a boar before quickly shifting to mewing like a bumbling baby rolton as it slips and slides after birth."
	result = dothis "soc task ", /completed your task|the museum in/
		if result =~ /completed your task/
			Script.run('go2', 'u312017')
			exit
		else
			echo "If this wasn't enough then you'll need to do more comical actions on your own! Type ;u when you're done and ready to go!"
			pause_script
			Script.run('go2', 'u312017')
			exit
		end
end
#Begin task
if script.vars.empty?
	puts "You need to put in a command: Task or check."
elsif script.vars[0] == "check"
	Script.run('go2', 'voln meditation chamber')
	result = dothis "pray", /eagle|flower|butterfly|river|tapestry|wine|hiker|lute|jump in|storm|swim/	
	if result =~/baby eagle barely hatched from its egg/
		echo "You just started. 0-9%. Remember, this is only an estimate."
	elsif result =~/a flower that has not yet begun to open/
		echo "10-19%. Remember, this is only an estimate and could be off by 5%."
	elsif result =~/butterfly drying its wings on a leaf/
		echo "20-29%. Remember, this is only an estimate and could be off by 5%."
	elsif result =~/headwaters of a mighty river/
		echo "30-39%. Remember, this is only an estimate and could be off by 5%."
	elsif result =~/intricate tapestry/
		echo "40-49%. Remember, this is only an estimate and could be off by 5%."
	elsif result =~/bowls of wine/
		echo "50-59%. Remember, this is only an estimate and could be off by 5%."
	elsif result =~/a vision of a hiker as he clears the peak of a hill/
		echo "60-69%. Remember, this is only an estimate and could be off by 5%."
	elsif result =~/a lute, finely crafted, but missing a third of its strings/
		echo "70-79%. Remember, this is only an estimate and could be off by 5%."
	elsif result =~/desire to jump in but cannot/
		echo "80-89%. Remember, this is only an estimate and could be off by 5%."
	elsif result =~/a thunder storm begins to abate/
		echo "Almost there, just a little further. 90-99%. Remember, this is only an estimate and could be off by 5%."
	elsif result =~/dive in and swim to the bottom/
		echo "Hopefully that should do it, but remember, messaging can overlap, so you may need just a bit more!"
		echo "Off to see the monk in 3 seconds..."
		pause 3
		target_rooms = voln_monk[Society.rank]
		voln_monk_room = Map.current.find_nearest(target_rooms)
		Script.run('go2',"#{voln_monk_room}")
		exit
	end
elsif script.vars[0] == "task"
	echo XMLData.society_task
	if XMLData.society_task =~ /Enter the arch in the Hall of the Brotherhood to begin your training./
		echo
		puts "You've joined the Order of Voln. Congratulations!  Type ;u to begin your journey.  The monk will tell you what to do.  Bear with him, he can be a little slow in speaking at times."
		echo
		pause_script
		Script.run('go2', 'u312001')
	elsif XMLData.society_task =~ /It is your eternal duty to release undead creatures from their suffering in the name of the Great Spirit Voln./
		echo 
		puts "No task to do at this time.  Continue to release undead creatures from their suffering."
		echo
		exit
#Return to Monastery
	elsif XMLData.society_task =~/You have completed your task and should return/
		if Society.status == "Order of Voln" and Society.rank < 27
			target_rooms = voln_monk[Society.rank]
			voln_monk_room = Map.current.find_nearest(target_rooms)
			Script.run('go2',"#{voln_monk_room}")
			exit
		else
			echo "Are you even IN Voln??"
			exit
		end
	elsif XMLData.society_task =~/return to the Ta'Vaalor monastery to take your next step/
		if Society.status == "Order of Voln" and Society.rank < 27
			target_rooms = voln_monk[Society.rank]
			voln_monk = Map.current.find_nearest(target_rooms)
			Script.run('go2',"#{voln_monk_room}")
			exit
		else
			echo "Are you even IN Voln??"
			exit
		end
#Step 2 Landing - tested and verified
	elsif XMLData.society_task =~/take an iron slab to the lake that lies at the base of/
		echo "You need some iron. If you have some iron, take out it now, then type ;u to unpause the script. Otherwise, ;kill volnstep and make yourself some. You can restart the script from anywhere after you have it."
		pause_script
		puts
		puts "Going to honor Eonak, waiting 3 seconds..."
		puts
		pause 3
		Script.run('go2', 'u52020')
		fput "put my iron in lake"
		Script.run('go2','u312002')
		exit
#Step 2 Vaalor tested and verified
	elsif XMLData.society_task =~ /by bringing him some scrap metal found/
		puts
		puts "Going to honor Eonak, waiting 3 seconds..."
		puts
		pause 3
		Script.run('go2', '6015')
		fput "stow all"
		loop{
		result = dothis "search machinery",/can't seem to find what you're looking for|don't seem to find anything worth your interest|beam at your new-found salvaged treasure/
		break if result =~/don't seem to find anything worth your interest|beam at your new-found salvaged treasure/
			}
		Script.run('go2', '10367')
		fput "give my metal to aerhseth"
		Script.run('go2', '21586')
		exit
#Step 3 Landing - tested and verified
	elsif XMLData.society_task =~ /the altar of weddings/
		puts
		puts "Going to honor Oleani, waiting 3 seconds..."
		puts
		pause 3
		Script.run('go2', 'bank')
		fput "withdraw 1000"
		Script.run('go2', 'u4055')
		fput "stow all"
		multifput "order 5", "buy"
		Script.run('go2', 'u6103')
		fput "put rose on altar"
		Script.run('go2', 'u312003')
		exit
#Step 3 Vaalor - tested and verified
	elsif XMLData.society_task =~ /take a bleeding heart rose to the grave marker of the lovers/
		puts
		puts "Going to honor Oleani, waiting 3 seconds..."
		puts
		pause 3
		Script.run('go2', '6093')
		fput "kneel"
		fput "stow all"
		loop{
		result = dothis "forage bleeding rose", /forage around but find nothing of interest|forage briefly and manage to find|stumble about in a fruitless attempt at foraging/
			break if result =~ /forage briefly and manage to find/
			}
		fput "stand" until standing?
		Script.run('go2', '5868')
		fput "place my rose"
		Script.run('go2', '25938')
		exit
#Step 4 Landing - tested and verified
	elsif XMLData.society_task =~ /Shanty town/i
		puts
		puts "Going to honor Cholen, waiting 3 seconds..."
		puts
		pause 3
		Script.run('go2', 'bank')
		coins = Char.level * 100
		fput "withdraw #{coins} silver"
		Script.run('go2', 'u7023')
		fput "drop #{coins} silver"
		fput "sing Praise be to Lord Cholen;Doer of many good deeds;Freer of the souls of many dead men"
		Script.run('go2', 'u312004')
#Step 4 Vaalor - tested and verified
	elsif XMLData.society_task =~/visit the tavern of Hagatha and sing a song honoring Lord Cholen/
		puts
		puts "You will be going to the bank and withdrawing coins ( (level * 100) + 100 worked for me), then going to Ta'Illistim."
		puts "Going to honor Cholen, waiting 3 seconds..."
		puts
		pause 3
		Script.run('go2', 'bank')
		coins = (Char.level * 100) + 100
		fput "withdraw #{coins} silver"
		Script.run('go2', '10071')
		fput "drop #{coins} silver"
		fput "sing I dance to honor Lord Cholen; Who brings us joy and fun; I sing such greatly praises; Today and forever more; Be joyous for all time, my friends!"
		waitfor "feel intense satisfaction at a task well done"
		Script.run('go2', '25939')	
#Step 5 Landing - tested and verified
	elsif XMLData.society_task =~/the Graveyard Gate and recite a poem/
		puts
		puts "Going to honor Jastev, leaving in 3 seconds..."
		puts
		pause 3
		Script.run('go2', 'u18002')
		fput "recite I wish honor upon Lord Voln;Jastev is sullen and self-possessed;Jastev has a keen interest in morbid poetry;Although Jastev is sullen, he is an artistic genius;As well as the God of visual arts;The twin of Lord Cholen who frees the undead"
		waitfor "You are overwhelmed by a sudden tingling sensation"
		echo
		echo "Another job well done..."
		echo 
		pause 3
		Script.run('go2', 'u312005')
#Step 5 Vaalor - tested and verified
	elsif XMLData.society_task =~/Jastev/
		puts
		puts "Going to honor Jastev, leaving in 3 seconds..."
		puts
		pause 3
		Script.run('go2', '5834')
		fput "recite I wish honor upon Lord Voln;Jastev is sullen and self-possessed;Jastev has a keen interest in morbid poetry;Although Jastev is sullen, he is an artistic genius;As well as the God of visual arts;The twin of Lord Cholen who frees the undead"
		waitfor "feel intense satisfaction at a task well done"
		Script.run('go2', '25940')
#Step 6 Landing
	elsif XMLData.society_task =~/and bury an acorn/
		fput "get my acorn"
	#Has an acorn
		if GameObj.right_hand.name == 'large acorn' or GameObj.left_hand.name == 'large acorn'
			puts
			puts "Going to honor Imaera, leaving in 3 seconds..."
			puts
			pause 3
			imaerashrine.call
	#No acorn
		else
			echo
			echo "If you have an acorn get it out now and place it in your left hand. When you're ready, type ;u to unpause the script. Otherwise, type ;u now."
			echo
			pause_script
		end
	#Got out their acorn and unpaused the script
	if GameObj.right_hand.name == 'large acorn' or GameObj.left_hand.name == 'large acorn'
		echo "You're ready to go! Heading out in 5 seconds"
		pause 5
		echo "imaerashrine.call"
	else
	#Didn't have an acorn in the end
		Script.run('go2', 'u7120')
		pause 1
		GameObj.loot.find{|item|
		if item.name == 'large acorn'
			fput "get acorn"
		end
		}
		if GameObj.right_hand.name == 'large acorn' or GameObj.left_hand.name == 'large acorn'
				imaerashrine.call
			else
				Script.run('go2', 'u7121')
				GameObj.loot.find{|item|
				if item.name == 'large acorn'
					fput "get acorn"
				end
				}
					if GameObj.right_hand.name == 'large acorn' or GameObj.left_hand.name == 'large acorn'
						imaerashrine.call
					else
						fput "down"
						echo
						echo "Oh no! No acorns. When you find one, go back to the Voln courtyard, place it in your left hand, and restart this script."
						echo
						exit
					end	
				end
			end
#Step 6 Vaalor
	elsif XMLData.society_task =~/altar in the Rambling Meadows and offer Lady Imaera a sprig of her lace/
		Script.run('go2', '10375')
		fput "kneel"
		loop{
		result = dothis "forage lace", /forage around but find nothing of interest|forage briefly and manage to find|stumble about in a fruitless attempt at foraging/
			break if result =~ /forage briefly and manage to find/
			}
		fput "stand" until standing?
		Script.run('go2', '6011')
		fput "offer my lace to imaera"
		sleep 1
		Script.run('go2', '25944')
#Step 7 Landing
	elsif XMLData.society_task =~/place some coral in the sea/
		echo "Step 7"
		echo 
		echo "You need coral. If you have coral, please place it in your left hand and type ;u to unpause the script. Otherwise, type ;u now."
		pause_script
		if GameObj.left_hand.noun == 'coral'
			charlshrine.call
		else
			echo
			echo "Ending this script now. When you find coral come back and run this script again."
			echo
			exit
		end
#Step 7 Vaalor
	elsif XMLData.society_task =~/south side of the Lake of Fear and return a piece of coral to the waters there/
		echo "Step 7"
		echo 
		echo "You need coral. If you have coral, please place it in your left hand and type ;u to unpause the script. Otherwise, type ;u now."
		pause_script
		if GameObj.left_hand.noun == 'coral'
			charlshrine2.call
		else
			echo
			echo "Ending this script now. When you find coral come back and run this script again."
			echo
			exit
	end
#Step 8 Landing
	elsif XMLData.society_task =~/a wrestling contest/
		Script.run('go2', '6960')
		fput "go arch"
		multifput "open my #{Lich.lootsack}", "stow all"
		fput "say :loud Kai, I challenge you to wrestle!"
		waitfor "motions for you to attack"
		loop {
				['punch','throw','kick'].each { |brawl|
				fput "stand" until standing?
				waitrt?
				result = dothistimeout "#{brawl} kai",3,/What were you referring to|Kai/
				break if result =~ /What were you referring to/
												}
			}
		fput "out"
		Script.run('go2', '18205')
#Step 8 Vaalor
	elsif XMLData.society_task =~/challenge Lord Kai to a wrestling match/
		Script.run('go2', '13495')
		fput "go arch"
		multifput "open my #{Lich.lootsack}", "stow all"
		fput "say :loud Kai, I challenge you to wrestle!"			
		waitfor "motions for you to attack"
		loop {
			   fput "punch kai"
			   sleep 1
			   fput "stand" 
			   sleep 1
			   fput "throw kai"
			   sleep 1
			   fput "stand"  
			   sleep 1
			   fput "kick kai"
			   sleep 1
			   fput "stand"
			   sleep 1
			   break if get=~/by a sudden tingling sensation/
			  }
		fput "out"
		Script.run('go2', '25966')
		exit
#Step 9 Landing
	elsif XMLData.society_task=~/beneath the Graveyard and bring light and warmth/i
		puts
		puts "If you can't open the graveyard gate you'll need to wait for someone to open it. Otherwise, you can't get where you need to go. Waiting 10 seconds..."
		puts
		sleep 10
		puts
		puts "Going to honor Phoen, leaving in 3 seconds..."
		puts
		pause 3
		Script.run('go2', 'bank')
		fput "withdraw 100"
		Script.run('go2', '1244')
		multifput "order 16", "buy"
		Script.run('go2', '18204')
		fput "light votive with lamp"
		Script.run('go2', '4140')
		result = dothis "look gate", /The gate is open|The gate is closed/
		if result=~ /The gate is open/
			fput "go gate"
		else
			spell_list = [407, 304, 1207, 1604]
			if spell_num = spell_list.find { |num| Spell[num].known? }
				spell = Spell[spell_num]
				if spell.affordable?
					multifput "prep #{spell}","cast at gate"
					fput "go gate"
				else
					wait_until spell.affordable?
					multifput "prep #{spell}","cast at gate"
					fput "go gate"
				end
			else
				puts
				puts "Well, you need to open this gate because you can't put a lit candle in your packs. You're just going to have to wait until it's open."
				puts
				waitfor /^(?:With a shocking lack of resistance, t|T)he (?:huge )?(?:bronze )?gate .* open|^The ancient hinges of the gate creak loudly as they give way|^Summoning the power .*? gate opens|the gate slowly opens wide enough to allow passage|The bronze gate pops open|^It's opened wide enough to slip through now\.  That thick chain won't let it open any farther\.$|just (came|went) through a massive bronze gate\.$/ 
				fput "go gate"
			end
		end
		Script.run('go2', '7229')
		fput "wave votive"
		Script.run('go2', '18204')
		exit
#Step 9 Vaalor
	elsif XMLData.society_task=~/bring light to stave off the darkness/i
		Script.run('go2', 'bank')
		fput "withdraw 50"
		Script.run('go2', '10372')
		fput "order 1"
		fput "buy"
		Script.run('go2', '25965')
		fput "light votive with fire"
		Script.run('go2', '10685')
		fput "wave votive"
		waitfor "a sudden tingling sensation"
		Script.run('go2', '26965')
		exit
#Step 10 Landing
	elsif XMLData.society_task =~/Lady Lorminstra's temple and offer up on her altar/
		Script.run('go2', 'bank')
		fput "withdraw 500"
		Script.run('go2', '325')
		fput "stow all"
		fput "order 1"
		fput "buy"
		Script.run('go2', '7523')
		fput "put my leaf on altar"
		fput "pray"
		Script.run('go2', '18203')
		exit
#Step 10 Vaalor
	elsif XMLData.society_task =~/up on the altar there some healing herbs and prayer/
		echo "You need an herb. It needs to be a leaf for our purposes. Acantha leaf works nicely. Run get one, have it in you hand, and then ;unpause."
		pause_script
		Script.run('go2', '10370')
		result = dothis "put my leaf on altar", /won't fit on the haon altar|^You put/
			if result =~/won't fit on the haon altar/
				echo "Ugh, stuff on the altar. Clear it off then ;unpause"
				pause_script
			end
		fput "put my leaf on altar"
		fput "pray"
		waitfor "tingling sensation"
		Script.run('go2', '25964')
		exit
#Step 11 Landing
	elsif XMLData.society_task =~/Shore of Dreams|go to Lord Ronan's shrine/
		echo
		echo "You're off to honor Ronan, leaving in 3..."
		Script.run('go2', '7926')
		fput "lie"
		pause 4
		echo "You're getting sleepy..."
		pause 2
		echo "...very sleepy."
		waitfor "What is night and light, fear and death, hope and despair, laughter and tears, delight and terror?"
		echo "Do you know?? You have 15 seconds to ANSWER or I will answer for you!"
		waitfor "you are nearly too late"
		fput "say life"
		Script.run('go2', '18202')
		exit
#Step 11 Vaalor
	elsif XMLData.society_task =~/are to go to the Hall of the Arkati/
		start_script 'go2', ['13494']
		wait_while {running? 'go2'}
		fput "lie"
		sleep 1
		fput "rest"
		waitfor "At least until tomorrow morning comes"
		fput "say shadow"
		sleep 1
		Script.run('go2', '25963')
#Step 12 Landing Tested and verified
	elsif XMLData.society_task =~/Wehnimer's tombstone in the Graveyard/
		echo "You're off to honor Lumnis, leaving in 3..."
		Script.run('go2', '7262')
		multifput "search", "search"
		waitfor "must be only one word"
		fput "say Koar"
		Script.run('go2', '18201')
		exit
#Step 12 Vaalor
	elsif XMLData.society_task =~/proper homage to the banner of knowledge/
		echo 
		echo "This requires a trip to Ta'Illistim. If you would prefer to travel your own way, exit the script and start it when you get across the Lake. Otherwise, type ;unpause now."
		pause_script
		Script.run('go2', '13233')
		multifput "bow banner", "look banner"
		echo
		echo "You're own your own here. Follow instructions and when you're done you'll move on. You have to look for the room with the right answer to the question you were given."
		waitfor "a sudden tingling sensation"
		echo "When you're ready to go back to Ta'Vaalor, ;unpause"
		pause_script 
		Script.run('go2', '25692')
		exit
#Step 13 Landing Tested and verified
	elsif XMLData.society_task =~/I have come to honor Koar, master of mana/
		echo
		echo "You're off to honor Koar, leaving in 3..."
		echo 
		pause 3
		Script.run('go2', '7544')
		fput "kneel"
		fput "say I have come to honor Koar, master of mana."
		Script.run('go2', '18200')
		exit
#Step 13 Vaalor
	elsif XMLData.society_task =~/to go to the statue in Shimaerslin Wey, prostrate yourself/
		Script.run('go2', '3539')
		fput "kneel"
		fput "say I have come to honor Koar, master of mana."
		Script.run('go2', '25961')
		exit
#Step 14 Landing
	elsif XMLData.society_task =~/Coastal Cliffs inscribed with three messages/
		echo
		echo "Honoring Tonis in 3..."
		echo
		pause 3	
		Script.run('go2', '500')
		fput "say you have not been forgotten"
		Script.run('go2', '18199')
		exit
#Step 14 Vaalor
	elsif XMLData.society_task =~/seek out the boulder along the Sylvarraend Road/
		echo 
		echo "This requires a trip to Ta'Illistim. If you would prefer to travel your own way, exit the script and start it when you get across the Lake. Otherwise, type ;unpause now."
		pause_script
		Script.run('go2', '1836')
		sleep 3
		fput "say you have not been forgotten"
		Script.run('go2', '25960')
		exit	
    #Step 15 Landing
	elsif XMLData.society_task =~/magical workshop in the catacombs/
		Script.run('go2', '7542')
		fput "touch broadsword"
		Script.run('go2', '18198')
		exit
    #Step 15 Vaalor
	elsif XMLData.society_task =~/the Temple of Lord Eonak in the caverns of Zul Logoth and pray at his altar/
		if Room.current.id == 16727
			echo "Already there"
			multifput "pray hammer", "pray anvil" 
			echo "Going to Ta'Vaalor, hope you still have those coins! Type ;u when ready to go"
			Script.run('go2', '25957')
			exit
		else
			echo "This trip will take you to Zul Logoth. You will need 2000 coins for the carts. If you want to travel now, type ;u. Otherwise, travel on your own and restart the script when you arrive at Temple of Eonak, East Sanctuary. Remember to arm yourself."
			pause_script
			Script.run('go2', 'bank')
			fput "withdraw 2000 silver"
			Script.run('go2', '16727')
			multifput "pray hammer", "pray anvil" 
			pause_script
			echo "Going to Ta'Vaalor, hope you still have those coins!"
			Script.run('go2', '25957')
			exit
		end
    #Step 16 Landing - long stemmed roses Tested and verified
	elsif XMLData.society_task =~/a dozen perfect long stemmed roses/
		echo "When I did this task I categorically, without question, no doubt, did NOT NOT NOT have to put silvers in the almsbox. Let me know if you find differently for yourself."
		echo "Also, I had to purchase a dozen long stemmed roses for this task. If you find differently, PLEASE tell me."
		echo "Off to honor Oleani in 3 seconds..."
		pause 3
		start_script 'go2', ['bank']
		wait_while {running? 'go2'}
		fput "withdraw 6500 silver"
		start_script 'go2', ['8715']
		wait_while {running? 'go2'}
		fput "stow all"
		multifput "order 6", "buy"
		start_script 'go2', ['4042']
		wait_while {running? 'go2'}
		fput "drop my roses"
		start_script 'go2', ['bank']
		wait_while {running? 'go2'}
		fput "deposit all"
		start_script 'go2', ['18197']
		wait_while {running? 'go2'}
		exit
    #Step 16 Vaalor
	elsif XMLData.society_task =~/honor Oleani/
		echo "Need to buy a ring and a band. Going to the bank for some coins."
		start_room=Room.current.id
		start_script 'go2', ['bank']
		wait_while {running? 'go2'}
		fput "withdraw 1000 silver"
		start_script 'go2', ['10328']
		wait_while {running? 'go2'}
		fput "stow all"
		multifput "order 1", "buy"
		multifput "order 2", "buy" 
		start_script 'go2', ['10268']
		wait_while {running? 'go2'}
		multifput "put band on altar", "put ring on altar", "bow"
		pause_script
		echo "Back to where you started."
		start_script 'go2', [start_room]
		wait_while {running? 'go2'}
    #Step 16 Landing - Bridal Blush roses
	elsif XMLData.society_task =~/a bouquet of Bridal Blush roses/
		echo "When I did this task I categorically, without question, no doubt, did NOT NOT NOT have to put silvers in the almsbox. Let me know if you find differently for yourself."
		echo "Also, I had to purchase a dozen long stemmed roses for this task. If you find differently, PLEASE tell me."
		start_script 'go2', ['bank']
		wait_while {running? 'go2'}
		fput "withdraw 6500 silver"
		start_script 'go2', ['8715']
		wait_while {running? 'go2'}
		fput "stow all"
		multifput "order 4", "buy"
		start_script 'go2', ['4042']
		wait_while {running? 'go2'}
		fput "drop my roses"
		start_script 'go2', ['bank']
		wait_while {running? 'go2'}
		fput "deposit all"
		start_script 'go2', ['18197']
		wait_while {running? 'go2'}
		exit
    #Step 17 Vaalor
	elsif XMLData.society_task =~ /teach you humility/
		start_room=Room.current.id
		start_script 'go2', ['voln']
		wait_while {running? 'go2'}
		echo 
		echo "You need to find a couple of Voln members to go with you on the next step. Type ;u to unpause the script when you're ready."
		pause_script
		start_script 'go2', ['10437']
		wait_while {running? 'go2'}
		step17.call
    #Step 17 Landing Tested and verified
	elsif XMLData.society_task =~/the museum in Wehnimer's Landing/
		Script.run('go2', '3600')
		echo 
		echo "You need to find a Voln member to go with you on the next step They need to laugh A LOT. Type ;u to unpause the script when you're ready."
		pause_script
		echo "Off to honor Cholen in 3 seconds.."
		pause 3
		Script.run('go2', '15567')
		step17.call
    #Step 18 Landing Tested and verified
	elsif XMLData.society_task =~/fisherman's village/
		echo
		echo "Off to honor Jastev in 3 seconds.."
		pause 3
		start_script 'go2', ['524']
		wait_while {running? 'go2'}
		fput "touch shrine"
		start_script 'go2', ['18195']
		wait_while {running? 'go2'}
		exit
    #Step 18 Vaalor
	elsif XMLData.society_task =~/the small grey stone shrine/
		Script.run('go2', '10176')
		fput "touch shrine"
		Script.run('go2', '25954')
		exit
    #Step 19 Landing
	elsif XMLData.society_task =~/she graces you with her presence, show her the proper courtesy and respect/
		echo
		echo "Off to honor Imaera in 3 seconds.."
		pause 3
		start_script 'go2', ['6459']
		wait_while {running? 'go2'}
		fput "stow all"
		fput "kneel"
		fput "pray"
		pause 2
		fput "pray"
		fput "bow deer"
		start_script 'go2', ['18194']
		wait_while {running? 'go2'}
		exit
	#Step 19 Vaalor
	elsif XMLData.society_task =~/to seek out the shrine in the Rambling Meadows and there pray/
		echo "Step 19, Vaalor"
		Script.run('go2', '6011')
		fput "stow all"
		fput "kneel"
		fput "pray shrine"
		fput "bow deer"
		Script.run('go2', '25953')
    #Step 20 Landing Tested and Verified
	elsif XMLData.society_task =~/drop an appropriate offering of coins into the sea/
		echo
		echo "Off to honor Charl in 3 seconds..."
		pause 3
		Script.run('go2', 'bank')
		coins = Char.level * 100
		fput "withdraw #{coins}"
		Script.run('go2', 'u84208')
		fput "drop #{coins} silver"
		Script.run('go2', 'u312020')
		exit
	#Step 20 Vaalor
	elsif XMLData.society_task =~/ go to the docks that lead out onto the Lake of Fear and there drop an appropriate offering of coins/
		Script.run('go2', 'bank')
		coins = Char.level * 100
		fput "withdraw #{coins}"
		Script.run('go2', '10119')
		fput "drop #{coins} silver"
		Script.run('go2', '25952')
		exit
    #Step 21 Landing
	elsif XMLData.society_task =~/place a weapon into the pool there as an offering/
		echo
		echo "Off to honor Kai in 3 seconds..."
		echo
		pause 3
		start_script 'go2', ['bank']
		wait_while {running? 'go2'}
		fput "withdraw 250"
		Script.run('go2', 'u2008')
		empty_hands
		fput "order 7"
		fput "buy"
		Script.run('go2', 'u10115')
		pause 0.5
		fput "drop broadsword in pool"
		waitfor "You are overwhelmed by a sudden tingling sensation"
		Script.run('go2', 'u312021')
		exit
	#Step 21 Vaalor
	elsif XMLData.society_task =~/go to deep under the mountains to the Czeroth Caverns and place a weapon into the pool of water/
		echo "You will be going to Zul Logoth. We will go to the bank and get your money, buy a weapon, and head off. Type ;u when you're prepared. Try to be as light as you can or be good at climbing to get over the boulder!"
		pause_script
		echo
		echo "Off to honor Kai in 3 seconds..."
		echo
		pause 3
		Script.run('go2', 'bank')
		fput "withdraw 3200"
		Script.run('go2', '10367')
		multifput "order 2", "buy", "stow all"
		echo "Type ;u when you are safe to travel!"
		pause_script
		Script.run('go2', '9609')
		fput "stow all"
		pause 1
		fput "get my sword"
		if GameObj.right_hand.name == "sword"
			fput "drop my sword"
			fput "climb rocks"
		else
			echo "Uh oh. That's not the sword. Pausing until you get out the double-edged sword. Type ;u when ready."
			pause_script
			fput "drop my sword"
			fput "climb rocks"
		end
		fput "gird"
		echo "Ready for the trip back? Type ;u when you are."
		pause_script
		Script.run('go2', '25951')
		exit
    #Step 22 Landing Tested and verified
	elsif XMLData.society_task =~/the fire guardians live and throw in a blue crystal as an offering/
		echo "For this task you will need a blue crystal. If you have one, take it out and put it in your left hand."
		echo "If not, ;kill volnstep and rerun from anywhere."
		echo "Type ;u when you have your blue crystal you're ready to go."
		pause_script
		echo
		echo "Off to honor Phoen in 3 seconds..."
		echo
		pause 3
		start_script 'go2', ['4131']
		wait_while {running? 'go2'}
		fput "drop blue crystal in lava"
		start_script 'go2', ['18191']
		wait_while {running? 'go2'}
		exit
	#Step 22 Vaalor Tested and verified
	elsif XMLData.society_task =~/You are to head into the depths of Wraithenmist and seek out a dock there/
		echo "We will be off to Ta'Illstim with a lit votive. Type ;u."
		pause_script
		echo
		echo "Off to honor Phoen in 3 seconds..."
		echo
		pause 3
		Script.run('go2', 'bank')
		fput "withdraw 100"
		Script.run('go2', '10372')
		multifput "stow all", "order 1", "buy"
		Script.run('go2', '25950')
		fput "light my votive with fire"
		echo "Now, you will have to go to Ta'Illistim with that lit candle in your hand. You can't put it away. Type ;u when you're prepared to go."
		pause_script
		Script.run('go2', '1830')
		fput "wave my votive"
		fput "drop votive"
		fput "gird"
		echo "Time to head back! Type ;u if you're ready."
		pause_script
		Script.run('go2', '25950')
		exit
    #Step 23 Landing Tested and verified
	elsif XMLData.society_task =~/temple/
		puts
		puts "You will need to find someone with no deeds and offer them one of yours."
		puts  "This time, you are on your own. However, we can run to the room you need to go to so you know where it is. the room number you want to go to is 7523."
		puts
		puts "Leaving for the Lorminstra's temple in 3 seconds..."
		puts
		pause 3
		Script.run('go2', '7523')
		puts 
		puts "Now, find someone without a deed and bring them back here."
		puts "You'll need to say Lorminstra, give <their name> my deed."
		puts
		exit
	#Step 23 Vaalor
	elsif XMLData.society_task =~/You are to go to the altar in the Hall of the Arkati where the dead return after departing/
		puts
		puts "You will need to find someone with no deeds and offer them one of yours."
		puts  "This time, you are on your own. However, we can run to the room you need to go to so you know where it is."
		echo 
		puts "Leaving for the Hall of Arkati in 3 seconds..."
		puts
		pause 3
		Script.run('go2', '10370')
		puts 
		puts "Now, find someone without a deed and bring them back here, and say Lorminstra, give THEIR NAME my deed."
		puts
		exit
    #Step 24 Landing
	elsif XMLData.society_task =~/seek out the onyx altar atop Melgorehn's Reach and lie down when the moon shines its light upon it/
		echo
		echo "You need to be unencumbered for this trip. Type ;u when ready to go!"
		echo
		Script.run('go2', 'u52004')
		wheel= dothis "turn wheel",/locking bar catches, holding the wheel securely in place|a locking bar is holding it in place/
		fput "down"
		fput "out"
		fput "go bridge"
		fput "east"
		fput "east"
		fput "east"
		fput "go slope"
		sleep 1
		if Room.current.id == 18175
			echo 
			echo "Well, that's a problem. You likely need to either empty your hands, lighten your load, or both. Restart ;volnstep when you can climb."
			exit
		elsif Room.current.id == 18176
			echo "you made it!"
			Script.run('go2', 'u52010')
		end
		echo "Okay, this part you have to do manually."
		echo "E under O - press R rune. E under S - press O rune. E under Z - press Z rune. E under R - press S rune. If you get \"nothing happens\", when you push a rune, you need to push E to reset and look at them again and start over."
		echo "When you get the stairs, type ;u."
		pause_script
		fput "go staircase"
		fput "west"
		Script.run('go2', 'u52012')
		fput "close dam"
		echo 
		echo "This may be a long wait. Rumor has it that this can take as long as ten minutes..."
		echo
		waitfor "riding on the trellis, crawls down the side of the mountain and comes to a clunky stop"
		fput "open dam"
		fput "go cab"
		echo 
		echo "This also may be a long wait."
		echo
		waitfor "ledge comes into view and the cab grinds to a clunky halt"
		fput "go out"
		fput "go fog"
		fput "search"
		fput "search wall"
		fput "climb vine"
		fput "go opening"
		echo
		echo "Now we have to wait for a moon beam..."
		echo
		waitfor "a beam of moon light peeks through several tiny holes in the intricate ceiling"
		fput "lie on altar"
		waitfor "overwhelmed by a sudden tingling sensation"
		fput "stand" until standing?
		fput "go shaft"
		gowater.call
		wait_until { XMLData.room_id == 52020 }
		Script.run('go2', 'u312024')
		exit
    #Step 24 Ta'Vaalor Tested but unverified
	elsif XMLData.society_task =~/jump into the pit that lies along the Path to Enlightenment in Ta'Vaalor and face the challenges there that Lord Ronan has in store for you/
		Script.run('go2', 'u14116030')
		echo
		echo "Off to honor Ronan in 3 seconds..."
		echo
		pause 3
		fput "jump in pit"
		pause 3
		fput "stand" unless standing? 
		pause 1
		waitrt?
		loop{
		result = dothis "search",/search around and find nothing|search around and find/
		if result =~ /find a simple stone-carved door/
			break
		else
			pause 2
			waitrt?
		end
			}
		pause 2
		waitrt?
		fput "go door"
		loop{
		result = dothis "sniff",/seem to pick out any one new scent|find your nose fills with the scent of/
			if result =~/battlefield/
				pause 2
				waitrt?
				break
		else
			pause 2
			waitrt?
		end	
			}
		fput "go battlefield"
		loop{
		result = dothis "listen", /yourself listening to the sound of|have some difficulty/
			if result=~/nightingale/
				pause 1
				waitrt?
				break
			else
				pause 1
				waitrt?
			end
			}
			fput "go nightingale"
			waitfor "simply NOD to me"
			fput "nod to ronan"	
			loop{
				result = waitfor /Ronan selects/
			if result =~/taking towards your right side/
				fput "lean left"
				break
			elsif result =~/not too subtle feint to your left/
				fput "lean right"
				break
			elsif result =~/at the height of your chest/
				fput "fall"
				break
			elsif result =~/glancing at your feet/
				fput "jump"
				break
			elsif result=~/and you fall asleep/
				fput "roll"
				break
			elsif result=~/a clean swipe at your head/
				fput "duck"
				break
			end
			}
			waitfor "Nicely done"
			loop{
			result = waitfor /Ronan selects/
			if result =~/taking towards your right side/
				fput "lean left"
				break
			elsif result =~/not too subtle feint to your left/
				fput "lean right"
				break
			elsif result =~/at the height of your chest/
				fput "fall"
				break
			elsif result =~/glancing at your feet/
				fput "jump"
				break
			elsif result=~/and you fall asleep/
				fput "roll"
				break
			elsif result=~/a clean swipe at your head/
				fput "duck"
				break
			end
			}
			waitfor "Nicely done"
			loop{
			result = waitfor /Ronan selects/
			if result =~/taking towards your right side/
				fput "lean left"
				break
			elsif result =~/not too subtle feint to your left/
				fput "lean right"
				break
			elsif result =~/at the height of your chest/
				fput "fall"
				break
			elsif result =~/glancing at your feet/
				fput "jump"
				break
			elsif result=~/and you fall asleep/
				fput "roll"
				break
			elsif result=~/a clean swipe at your head/
				fput "duck"
				break
			end
			}
			waitfor "Nicely done"
			loop{
			result = waitfor /Ronan selects/
			if result =~/taking towards your right side/
				fput "lean left"
				break
			elsif result =~/not too subtle feint to your left/
				fput "lean right"
				break
			elsif result =~/at the height of your chest/
				fput "fall"
				break
			elsif result =~/glancing at your feet/
				fput "jump"
				break
			elsif result=~/and you fall asleep/
				fput "roll"
				break
			elsif result=~/a clean swipe at your head/
				fput "duck"
				break
			end
			}
			waitfor "Nicely done"
			loop{
			result = waitfor /Ronan selects/
			if result =~/taking towards your right side/
				fput "lean left"
				break
			elsif result =~/not too subtle feint to your left/
				fput "lean right"
				break
			elsif result =~/at the height of your chest/
				fput "fall"
				break
			elsif result =~/glancing at your feet/
				fput "jump"
				break
			elsif result=~/and you fall asleep/
				fput "roll"
				break
			elsif result=~/a clean swipe at your head/
				fput "duck"
				break
			end
			}
			waitfor "Nicely done"
			loop{
			result = waitfor /Ronan selects/
			if result =~/taking towards your right side/
				fput "lean left"
				break
			elsif result =~/not too subtle feint to your left/
				fput "lean right"
				break
			elsif result =~/at the height of your chest/
				fput "fall"
				break
			elsif result =~/glancing at your feet/
				fput "jump"
				break
			elsif result=~/and you fall asleep/
				fput "roll"
				break
			elsif result=~/a clean swipe at your head/
				fput "duck"
				break
			end
			}
			fput "stand" until standing?
#Step 25 Landing		
	elsif XMLData.society_task =~/Answer all his questions correctly/
		start_script 'go2', ['7626']
		wait_while {running? 'go2'}
		fput "lie"
		fput "search sand"
		fput "push sand"
		loop{
			result = dothis "search", /^You/
			break if result =~/staircase/
			}
		fput "stand"
		fput "go stair"
		fput "lie"
		loop {
		    	result = dothis "search", /^You/
			    break if result =~/curtain/
			 }
		fput "stand"
		fput "go curtain"
		fput "lie"
		fput "search" until get =~/pot/
		fput "ask hermit about task"
		echo "Wait for him to ask three questions. Answer each. Hope you were taking notes!"
		echo "What was the name of the man that visited Lord Fasthr and his men and helped them in their fight?"
		echo 
		echo "If not, perhaps this will help http://www.arkati.org/07/index.php?page=Voln%20For%20Dummies%20-%20Monk%20Wisdom    "
		echo "Type ;u when done."
		pause_script
		loop {
				result = dothis "search", /^You/
				break if result =~/curtain/
			 }
		fput "stand"
		fput "go curtain"
		fput "lie"
		loop {
				result = dothis "search", /^You/
				break if result =~/stair/
			 }
		fput "stand"
		fput "go stair"
		fput "out"
		start_script 'go2', ['18189']
		wait_while {running? 'go2'}
		exit
#Step 25 Ta'Vaalor Tested and verified
	elsif XMLData.society_task =~/You are to read the medallion that the monk gave you and seek out the place that it describes/
		echo
		echo "This trip will take you to Zul Logoth. Be prepared! At some point we will be going to the bank for 2000 silvers. "
		echo
		pause 3
		if checkright == "medallion" or checkleft == "medallion"
			fput "wear medallion" 
		elsif GameObj.inv.any?{|obj| obj.name == "glowing Lumnis medallion"}
			echo
			echo "Off to honor Lumnis in 3 seconds..."
			echo
			pause 5
		else
			echo
			echo "Something's wrong. Where's your medallion?? Going to the monk..."
			Script.run('go2', 'u14116031')
			waitfor "Take this medallion"
			fput "wear medallion"
		end
			5.times{
			result = dothis "read my lumnis medallion", /home of order to the Vaalor guardians|pale limestone altar in a glade|a wooded town|bleached troll bones lie piled|heart of activity for every guest of House Illistim|water falls in a rainbow of colors|nothing there to read/
			if result=~/pale limestone altar in a glade of a wooded town/
				echo "Off to Sylvarraend..."
				pause 1
				fput "gird"
				Script.run('go2', 'u13050021')
				fput "read my lumnis medallion"
				pause 5
			elsif result=~/home of order to the Vaalor guardians/
				echo "Off to Ta'Vaalor..."
				pause 1
				Script.run('go2', 'u14100075')
				fput "read my lumnis medallion"
				pause 5
			elsif result=~/bleached troll bones lie piled under a mountain/
				echo "Now we head to Zul Logoth, but getting 2000 silvers first..."
				pause 1
				Script.run('go2', 'bank')
				fput "withdraw 2000 silvers"
				Script.run('go2', 'u13011001')
				fput "read my lumnis medallion"
				pause 5
			elsif result=~/heart of activity for every guest of House Illistim/
				echo "off to Ta'Illistim"
				pause 1
				Script.run('go2', 'u13100042')
				fput "read my lumnis medallion"
				pause 5
			elsif result=~/water falls in a rainbow of colors/
				echo "To Cysaegir we go!"
				pause 1
				Script.run('go2', 'u14050018')
				fput "read my lumnis medallion"
				pause 5
			end
			}
			echo "Back to Voln..."
			pause 1
			Script.run('go2', 'u14116031')

	end
end
