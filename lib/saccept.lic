=begin

     author: Demandred
       name: saccept
       tags: inventory
    version: 1.0
		
		saccept is my new auto-accept and stow solution.
		
		Usage: 	;saccept # <stow selection>
						;saccept <stow selection> #
							These uses will accept # of items and stow them in the container you have
							setup under stow set <stow selection>
							i.e. - ;saccept 8 gem --- This will accept 8 items and stow them in your stow gem container
							
						;saccept #
							This will accept # of items and stow them in your default stow container
						
						;saccept <stow selection>
							This will accept items forever and put them in the stow set <stow container>
							
						If you mispell the stow container setting it will still use the default

		If problems are found, let me know! Enjoy!

			changelog:
				1.0 - (1-19-2021)
							Initial release.

=end


bag = nil
counter = nil
all_vars = script.vars[0]
VARS_PATTERN = /(?'bag'^[a-zA-Z]+$)|(?'counter'^\d+$)|(?'counter1'\d+) (?'bag1'[a-zA-Z]+$)|(?'bag2'^[a-zA-Z]+) (?'counter2'\d+$)/
match = all_vars.match(VARS_PATTERN)

if match&.named_captures&.fetch('bag') != nil
	bag = match&.named_captures&.fetch('bag')
elsif match&.named_captures&.fetch('bag1') != nil
	bag = match&.named_captures&.fetch('bag1')
elsif match&.named_captures&.fetch('bag2') != nil
	bag = match&.named_captures&.fetch('bag2')
end

if match&.named_captures&.fetch('counter') != nil
	counter = match&.named_captures&.fetch('counter')
elsif match&.named_captures&.fetch('counter1') != nil
	counter = match&.named_captures&.fetch('counter1')
elsif match&.named_captures&.fetch('counter2') != nil
	counter = match&.named_captures&.fetch('counter2')
end

if counter == nil
	status_tags
	while line = get
		#echo line
		if line =~ /.*? offers you.*?\<a exist="(.*?)" noun.*? The offer will expire in 30 seconds/i
			if checkright == nil
				put "accept"
				if bag == nil
					put "stow right"
				else
					put "stow right #{bag}"
				end
				next
			elsif checkleft == nil
				put "accept"
				if bag == nil
					put "stow left"
				else
					put "stow left #{bag}"
				end
				next
			else
				echo "**** YOU HAVE NO EMPTY HAND TO ACCEPT SOMETHING, EMPTY A/BOTH HAND/S AND RESTART THIS SCRIPT ****"
				exit
			end
		end
	end
else
	counter.to_i.times do
		result = waitfor "Click ACCEPT to accept the offer or DECLINE to decline it\.  The offer will expire in 30 seconds\."
		if result =~ /.* offers you (.*)\.  Click ACCEPT to accept the offer or DECLINE to decline it\.  The offer will expire in 30 seconds\./
			if checkright == nil
				put "accept"
				if bag == nil
					put "stow right"
				else
					put "stow right #{bag}"
				end
			elsif checkleft == nil
				put "accept"
				if bag == nil
					put "stow left"
				else
					put "stow left #{bag}"
				end
			else
				echo "**** YOU HAVE NO EMPTY HAND TO ACCEPT SOMETHING, EMPTY A HAND AND RESTART THIS SCRIPT ****"
				exit
			end
		end
	end
end
