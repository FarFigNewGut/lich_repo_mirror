=begin
  This script monitors all outgoing offers and ensures that only gems can be offered to players.  
  If an offer is made and the item in the right hand is **not a gem**, the script will automatically cancel the offer.
  
  This is just a simple script to prevent you from handing ANYTHING but a GEM to anther player such as when you are attempting to tip an empath or cleric.

  How It Works:
  1. Listens for the offer message format:  
     `"You offer your <item> to <player>, who has 30 seconds to accept the offer."`
  2. Checks if the **right-hand item** is a **gem**.
  3. If the item **is not a gem**, it issues the **CANCEL** command.
  4. If the item **is a gem**, the offer continues normally.

  author: Phocosoen, ChatGPT
  tags: offer, tip
  
=end

loop do
  line = get

  # Check for offer message
  if line =~ /You offer your (.*?) to (.*?), who has 30 seconds to accept the offer\./
    item_name = $1
    target = $2

    # Get the item in the right hand
    item = GameObj.right_hand

    if item.nil?
      echo "Error: No item detected in your right hand. Cancelling offer."
      fput "cancel"
      next
    end

    # Verify the item is a gem
    unless item.type.include?("gem")
      echo "The offered item (#{item.name}) is NOT a gem! Cancelling offer."
      fput "cancel"
      next
    end

    echo "Offer verified: You are offering a gem (#{item.name}) to #{target}."
  end
sleep 0.25
end
