module Effects
  class Watcher
    # these effects are slow to populate in the game feed, but incredibly deadly
    # reaction time is paramount to success/survival
    class Condemn 
      Start = %r(The pungent stench of decay fills the air as mist rises from the floor around you!)
      End   = %r(The burden of condemnation lifts from your spirit.)
    end

    class Jaws
      Start = %r[Suddenly, you hear a loud \*clink\* as a large pair of carefully concealed metal jaws slam shut on your (right|left) leg!]
      End   = %r(The metal jaws restraining your movement snap apart.)
    end

    class Net
      Start = %r(Suddenly, a carefully concealed net springs up from the ground, completely entangling you!)
      End = %r(The net entangling you rips and falls apart.)
    end

    class SunderShield
      Start = %r(You feel your left arm go numb!)
      End = %r(The numbness in your left arm fades away.)
    end

    class Burrowed
      Start = %r(The ground seems to distort and shudder beneath your feet.)
    end

    class RiftSlow
      Start = %r(The cold seeps into your flesh, burrowing down into your bones.  The sensation leaves your muscles feeling rigid and unresponsive.)
    end

    def self.main()
      while line=get
        case line
        when Condemn::Start
          Effects::Debuffs.to_h["Condemn"] = Time.now + 60
        when Condemn::End
          Effects::Debuffs.to_h.delete("Condemn")
        when Jaws::Start
          Effects::Debuffs.to_h["Jaws"] = Time.now + 120
        when Jaws::End
           Effects::Debuffs.to_h.delete("Jaws")
        when Net::Start
          Effects::Debuffs.to_h["Net"] = Time.now + 120
        when Net::End
          Effects::Debuffs.to_h.delete("Net")
        when SunderShield::Start
          Effects::Debuffs.to_h["Sunder Shield"] = Time.now + 120
        when SunderShield::End
          Effects::Debuffs.to_h.delete("Sunder Shield")
        when Burrowed::Start
          Effects::Debuffs.to_h["Burrowed"] = Time.now + 30
        when RiftSlow::Start
          Effects::Debuffs.to_h["Rift Slow"] = Time.now + 30
        end
      end
    end

    Watcher.main()
  end
end